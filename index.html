<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DSE Hub v84 (å¢å¼ºç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ================= åŸºç¡€é‡ç½® ================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #6366F1;
            --primary-light: #818CF8;
            --primary-dark: #4F46E5;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: 1px solid rgba(255, 255, 255, 0.3);
            --text-primary: #1F2937;
            --text-secondary: #4B5563;
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 20px rgba(0, 0, 0, 0.06);
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.03);
            --radius-xl: 20px;
            --radius-lg: 16px;
            --radius-md: 12px;
            --radius-sm: 8px;
            --radius-xs: 6px;
            --transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* ğŸ¨ ä¸»é¢˜è‰²å®šä¹‰ä¿æŒä¸å˜... */
        [data-theme="default"] { --primary: #6366F1; --primary-light: #818CF8; --primary-dark: #4F46E5; --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        [data-theme="ocean"] { --primary: #06B6D4; --primary-light: #22D3EE; --primary-dark: #0891B2; --bg-gradient: linear-gradient(135deg, #06B6D4 0%, #0E7490 100%); }
        [data-theme="forest"] { --primary: #10B981; --primary-light: #34D399; --primary-dark: #059669; --bg-gradient: linear-gradient(135deg, #10b981 0%, #047857 100%); }
        [data-theme="sunset"] { --primary: #F97316; --primary-light: #FB923C; --primary-dark: #EA580C; --bg-gradient: linear-gradient(135deg, #F97316 0%, #C2410C 100%); }
        [data-theme="lavender"] { --primary: #8B5CF6; --primary-light: #A78BFA; --primary-dark: #7C3AED; --bg-gradient: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); }
        [data-theme="coral"] { --primary: #EC4899; --primary-light: #F472B6; --primary-dark: #DB2777; --bg-gradient: linear-gradient(135deg, #EC4899 0%, #BE185D 100%); }
        [data-theme="sky"] { --primary: #3B82F6; --primary-light: #60A5FA; --primary-dark: #2563EB; --bg-gradient: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%); }
        [data-theme="mint"] { --primary: #0D9488; --primary-light: #2DD4BF; --primary-dark: #0F766E; --bg-gradient: linear-gradient(135deg, #0D9488 0%, #115E59 100%); }
        [data-theme="dark"] { 
            --primary: #60A5FA; --primary-light: #93C5FD; --primary-dark: #3B82F6; 
            --bg-gradient: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
            --glass-bg: rgba(30, 41, 59, 0.95); --glass-border: 1px solid rgba(255, 255, 255, 0.15);
            --text-primary: #F8FAFC; --text-secondary: #CBD5E1;
        }

        body {
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ================= ç®¡ç†å‘˜æŒ‰é’®ä¼˜åŒ– ================= */
        .admin-btn {
            position: relative;
            background: linear-gradient(135deg, #F59E0B, #D97706) !important;
            color: white !important;
            border: 2px solid #D97706 !important;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.25);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            overflow: hidden;
        }

        .admin-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .admin-btn:hover::before {
            left: 100%;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.35);
            background: linear-gradient(135deg, #D97706, #B45309) !important;
        }

        .admin-btn i {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* ================= æŠ•ç¨¿ä¸­å¿ƒç§‘ç›®é€‰æ‹©ä¼˜åŒ– ================= */
        .category-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }

        .category-option {
            padding: 12px 16px;
            background: rgba(99, 102, 241, 0.08);
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .category-option:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .category-option.selected {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary-dark);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
        }

        .category-option.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 12px;
            font-weight: 800;
            color: white;
        }

        .category-icon {
            font-size: 20px;
            margin-bottom: 5px;
        }

        /* ================= æ¸¸æˆç§‘ç›®é€‰æ‹© ================= */
        .game-category-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .game-category-option {
            padding: 10px 14px;
            background: rgba(99, 102, 241, 0.08);
            border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .game-category-option:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: var(--primary);
        }

        .game-category-option.selected {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary-dark);
        }

        /* ================= ç•™è¨€ç‚¹èµæŒ‰é’® ================= */
        .like-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(239, 68, 68, 0.1);
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .like-btn:hover {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .like-btn.liked {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            font-weight: 700;
        }

        .like-btn.liked i {
            animation: heartBeat 0.3s ease;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* ================= ç®¡ç†åå°ä¼˜åŒ– ================= */
        .admin-tab {
            position: relative;
            padding: 14px 28px;
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            border-radius: var(--radius-md);
            font-weight: 800;
            font-size: 15px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-tab:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
        }

        .admin-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
            border-color: var(--primary-dark);
        }

        .admin-tab .badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            font-size: 11px;
            font-weight: 900;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        /* ================= æ¸¸æˆè®¾ç½®é¢æ¿ ================= */
        .game-settings-panel {
            background: var(--glass-bg);
            border-radius: var(--radius-lg);
            padding: 30px;
            border: var(--glass-border);
            box-shadow: var(--shadow-md);
            margin-bottom: 30px;
            animation: slideIn 0.3s ease;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 800;
        }

        .difficulty-options {
            display: flex;
            gap: 12px;
            margin-top: 10px;
        }

        .difficulty-option {
            padding: 10px 20px;
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            border-radius: var(--radius-md);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .difficulty-option:hover {
            background: rgba(99, 102, 241, 0.2);
        }

        .difficulty-option.selected {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary-dark);
        }

        .count-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .count-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 18px;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .count-btn:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
        }

        .count-display {
            font-size: 24px;
            font-weight: 900;
            color: var(--primary);
            min-width: 50px;
            text-align: center;
        }

        /* ================= ä¿æŒåŸæœ‰æ ·å¼ ================= */
        .app-container, .sidebar, .main-content, .nav-item, .knowledge-grid, .form-section, .games-grid, .game-container, .btn, .mobile-menu-btn {
            /* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .category-selector {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .game-category-selector {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .admin-tab {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body data-theme="default">
    <!-- è®¤è¯æ¨¡æ€æ¡†ä¿æŒä¸å˜ -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-card">
            <div style="text-align: center; margin-bottom: 30px;">
                <div class="logo">DSE HUB</div>
                <p class="tagline">é¦™æ¸¯ä¸­å­¦æ–‡å‡­è€ƒè¯•å­¦ä¹ å¹³å°</p>
            </div>
            
            <div class="form-group">
                <input type="email" class="form-input" id="login-email" placeholder="ç”µå­é‚®ç®±" required>
            </div>
            
            <div class="form-group">
                <input type="password" class="form-input" id="login-password" placeholder="å¯†ç " required>
            </div>
            
            <button class="btn btn-primary btn-block" onclick="handleLogin()">
                <i class="fas fa-sign-in-alt"></i> ç™»å½•
            </button>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-block" onclick="handleRegister()" style="background: rgba(99, 102, 241, 0.1); color: var(--primary);">
                    æ³¨å†Œæ–°è´¦å·
                </button>
                <button class="btn btn-block" id="resume-btn" onclick="handleResumeLogin()" style="display: none; background: rgba(99, 102, 241, 0.1); color: var(--primary);">
                    æ¢å¤ç™»å½•
                </button>
            </div>
            
            <p id="login-message" style="color: var(--danger); font-size: 13px; margin-top: 15px; text-align: center;"></p>
        </div>
    </div>

    <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
    <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ä¸»åº”ç”¨å®¹å™¨ -->
    <div class="app-container" style="display: none;">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar" id="sidebar">
            <div class="nav-header">
                <div class="logo">DSE HUB</div>
                <p class="tagline">ç‰ˆæœ¬ 84 â€¢ å¢å¼ºç‰ˆ</p>
            </div>
            
            <div class="nav-menu">
                <a class="nav-item active" onclick="switchPage('home')">
                    <i class="fas fa-book-open"></i>
                    <span>çŸ¥è¯†åº“</span>
                </a>
                <a class="nav-item" onclick="switchPage('chat')">
                    <i class="fas fa-comments"></i>
                    <span>ç•™è¨€æ¿</span>
                </a>
                <a class="nav-item" onclick="switchPage('games')">
                    <i class="fas fa-gamepad"></i>
                    <span>æ¸¸æˆä¸­å¿ƒ</span>
                </a>
                <a class="nav-item" onclick="switchPage('rank')">
                    <i class="fas fa-trophy"></i>
                    <span>æ’è¡Œæ¦œ</span>
                </a>
                <a class="nav-item" onclick="switchPage('submit')">
                    <i class="fas fa-pen-nib"></i>
                    <span>æŠ•ç¨¿ä¸­å¿ƒ</span>
                </a>
                <a class="nav-item" onclick="switchPage('settings')">
                    <i class="fas fa-cog"></i>
                    <span>è®¾ç½®</span>
                </a>
                
                <div id="admin-nav" class="nav-item admin-btn" onclick="switchPage('admin')" style="display: none; margin-top: 20px;">
                    <i class="fas fa-shield-alt"></i>
                    <span>ç®¡ç†åå°</span>
                </div>
            </div>
            
            <div class="user-card">
                <div class="username" id="username">è®¿å®¢</div>
                <div class="user-stats">
                    <span>ç§¯åˆ†: <strong id="user-score">0</strong></span>
                    <span>æ’å: <strong id="user-rank">#-</strong></span>
                </div>
                <button class="btn btn-block" onclick="handleLogout()" style="background: rgba(239, 68, 68, 0.1); color: var(--danger); margin-top: 10px;">
                    <i class="fas fa-sign-out-alt"></i> ç™»å‡º
                </button>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- çŸ¥è¯†åº“é¡µé¢ -->
            <div id="page-home" class="page" style="display: block;">
                <div class="page-header">
                    <h1 class="text-title">ğŸ“š çŸ¥è¯†å®åº“</h1>
                    <p class="text-subtitle">æŒæ¡ DSE æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œé«˜æ•ˆå¤‡è€ƒ</p>
                    <div class="category-tabs">
                        <button class="category-btn" onclick="changeKnowledgeCategory('all')">å…¨éƒ¨å­¦ç§‘</button>
                        <button class="category-btn active" onclick="changeKnowledgeCategory('chi')">ä¸­å›½è¯­æ–‡</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('eng')">è‹±å›½è¯­æ–‡</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('math')">æ•°å­¦</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('ls')">é€šè¯†æ•™è‚²</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('phy')">ç‰©ç†</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('chem')">åŒ–å­¦</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('bio')">ç”Ÿç‰©</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('econ')">ç»æµ</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('geo')">åœ°ç†</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('his')">å†å²</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('cit')">å…¬æ°‘ä¸ç¤¾ä¼šå‘å±•ç§‘</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('bafs')">ä¼ä¸šã€ä¼šè®¡ä¸è´¢åŠ¡æ¦‚è®º</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('ict')">èµ„è®¯åŠé€šè®¯ç§‘æŠ€</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('va')">è§†è§‰è‰ºæœ¯</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('music')">éŸ³ä¹</button>
                        <button class="category-btn" onclick="changeKnowledgeCategory('pe')">ä½“è‚²</button>
                    </div>
                </div>
                
                <div class="knowledge-grid" id="knowledge-grid">
                    <!-- çŸ¥è¯†å¡ç‰‡ä¼šåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                </div>
            </div>

            <!-- ç•™è¨€æ¿é¡µé¢ -->
            <div id="page-chat" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="text-title">ğŸ’¬ å­¦ä¹ äº¤æµåŒº</h1>
                    <p class="text-subtitle">ä¸åŒå­¦è®¨è®ºé—®é¢˜ï¼Œåˆ†äº«å­¦ä¹ å¿ƒå¾—</p>
                </div>
                
                <div class="chat-container">
                    <div class="chat-header" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <div style="font-size: 14px; color: var(--text-secondary);" class="readable-text-secondary">
                            å…± <span id="message-count">0</span> æ¡ç•™è¨€
                        </div>
                    </div>
                    
                    <div class="messages-container" id="chat-messages" style="max-height: 600px; overflow-y: auto; padding: 25px; background: rgba(255, 255, 255, 0.4); border-radius: var(--radius-lg); border: var(--glass-border); display: flex; flex-direction: column; gap: 20px;">
                        <!-- ç•™è¨€ä¼šåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                    </div>
                    
                    <div class="chat-input-area" style="background: var(--glass-bg); border-radius: var(--radius-lg); padding: 24px; border: var(--glass-border); box-shadow: var(--shadow-md); margin-top: 20px;">
                        <div class="input-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <div class="user-avatar" id="user-avatar" style="width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 16px;">U</div>
                            <div class="input-info readable-text-secondary">
                                æ­£åœ¨ä»¥ <span style="color: var(--primary); font-weight: 800;" id="current-username">è®¿å®¢</span> èº«ä»½å‘è¨€
                            </div>
                        </div>
                        
                        <textarea class="form-textarea" id="chat-input" 
                                  placeholder="è¾“å…¥ä½ çš„ç•™è¨€... (æŒ‰Ctrl+Enterå‘é€)" 
                                  rows="4"
                                  oninput="updateCharCount()"></textarea>
                        
                        <div class="input-footer" style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                            <div class="char-count readable-text-secondary" id="char-count">0/1000</div>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <button class="btn btn-primary" onclick="sendChatMessage()">
                                    <i class="fas fa-paper-plane"></i> å‘é€ç•™è¨€
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ¸¸æˆä¸­å¿ƒé¡µé¢ -->
            <div id="page-games" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="text-title">ğŸ® æ¸¸æˆä¸­å¿ƒ</h1>
                    <p class="text-subtitle">åœ¨æ¸¸æˆä¸­å­¦ä¹ ï¼Œå¯“æ•™äºä¹</p>
                </div>
                
                <div id="game-settings-panel" class="game-settings-panel" style="display: block;">
                    <h2 style="color: var(--primary); margin-bottom: 20px; font-size: 22px;">ğŸ¯ æ¸¸æˆè®¾ç½®</h2>
                    
                    <div class="settings-section">
                        <h3>é€‰æ‹©ç§‘ç›®ï¼ˆå¤šé€‰ï¼‰</h3>
                        <div class="game-category-selector" id="game-category-selector">
                            <div class="game-category-option" data-category="chi">
                                <i class="fas fa-language"></i>
                                <span>ä¸­å›½è¯­æ–‡</span>
                            </div>
                            <div class="game-category-option" data-category="eng">
                                <i class="fas fa-font"></i>
                                <span>è‹±å›½è¯­æ–‡</span>
                            </div>
                            <div class="game-category-option" data-category="math">
                                <i class="fas fa-calculator"></i>
                                <span>æ•°å­¦</span>
                            </div>
                            <div class="game-category-option" data-category="ls">
                                <i class="fas fa-globe-asia"></i>
                                <span>é€šè¯†æ•™è‚²</span>
                            </div>
                            <div class="game-category-option" data-category="phy">
                                <i class="fas fa-atom"></i>
                                <span>ç‰©ç†</span>
                            </div>
                            <div class="game-category-option" data-category="chem">
                                <i class="fas fa-flask"></i>
                                <span>åŒ–å­¦</span>
                            </div>
                            <div class="game-category-option" data-category="bio">
                                <i class="fas fa-dna"></i>
                                <span>ç”Ÿç‰©</span>
                            </div>
                            <div class="game-category-option" data-category="econ">
                                <i class="fas fa-chart-line"></i>
                                <span>ç»æµ</span>
                            </div>
                            <div class="game-category-option" data-category="geo">
                                <i class="fas fa-mountain"></i>
                                <span>åœ°ç†</span>
                            </div>
                            <div class="game-category-option" data-category="his">
                                <i class="fas fa-landmark"></i>
                                <span>å†å²</span>
                            </div>
                            <div class="game-category-option" data-category="cit">
                                <i class="fas fa-handshake"></i>
                                <span>å…¬æ°‘ä¸ç¤¾ä¼š</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>éš¾åº¦é€‰æ‹©</h3>
                        <div class="difficulty-options">
                            <div class="difficulty-option" data-difficulty="easy">ç®€å•</div>
                            <div class="difficulty-option selected" data-difficulty="medium">ä¸­ç­‰</div>
                            <div class="difficulty-option" data-difficulty="hard">å›°éš¾</div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>é¢˜ç›®æ•°é‡</h3>
                        <div class="count-selector">
                            <button class="count-btn" onclick="changeQuestionCount(-5)">-</button>
                            <div class="count-display" id="question-count">10</div>
                            <button class="count-btn" onclick="changeQuestionCount(5)">+</button>
                            <span class="readable-text-secondary" style="margin-left: 10px;">é¢˜</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-primary" onclick="startQuizGame()" style="flex: 1;">
                            <i class="fas fa-play"></i> å¼€å§‹çŸ¥è¯†é—®ç­”
                        </button>
                        <button class="btn" onclick="startMatchingGame()" style="flex: 1; background: rgba(16, 185, 129, 0.1); color: var(--success);">
                            <i class="fas fa-puzzle-piece"></i> å¼€å§‹é…å¯¹æ¸¸æˆ
                        </button>
                        <button class="btn" onclick="startTimedChallenge()" style="flex: 1; background: rgba(245, 158, 11, 0.1); color: var(--warning);">
                            <i class="fas fa-stopwatch"></i> å¼€å§‹é™æ—¶æŒ‘æˆ˜
                        </button>
                    </div>
                </div>
                
                <div class="games-grid" id="games-list">
                    <div class="game-card" onclick="showGameSettings()">
                        <div class="game-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="game-title text-bold">çŸ¥è¯†é—®ç­”</div>
                        <div class="game-description readable-text-secondary">
                            éšæœºæŠ½å–DSEçŸ¥è¯†ç‚¹ï¼Œæµ‹è¯•ä½ çš„æŒæ¡ç¨‹åº¦ã€‚æ¯ç­”å¯¹ä¸€é¢˜è·å¾—5ç§¯åˆ†ã€‚
                        </div>
                        <button class="btn btn-primary">å¼€å§‹æ¸¸æˆ</button>
                    </div>
                    
                    <div class="game-card" onclick="showGameSettings()">
                        <div class="game-icon">
                            <i class="fas fa-puzzle-piece"></i>
                        </div>
                        <div class="game-title text-bold">é…å¯¹æ¸¸æˆ</div>
                        <div class="game-description readable-text-secondary">
                            åŒ¹é…çŸ¥è¯†ç‚¹å’Œè§£é‡Šï¼Œé”»ç‚¼è®°å¿†èƒ½åŠ›ã€‚å…¨éƒ¨é…å¯¹æˆåŠŸè·å¾—20ç§¯åˆ†ã€‚
                        </div>
                        <button class="btn btn-primary">å¼€å§‹æ¸¸æˆ</button>
                    </div>
                    
                    <div class="game-card" onclick="showGameSettings()">
                        <div class="game-icon">
                            <i class="fas fa-stopwatch"></i>
                        </div>
                        <div class="game-title text-bold">é™æ—¶æŒ‘æˆ˜</div>
                        <div class="game-description readable-text-secondary">
                            åœ¨60ç§’å†…å›ç­”å°½å¯èƒ½å¤šçš„é—®é¢˜ã€‚æ ¹æ®æ­£ç¡®é¢˜æ•°è·å¾—ç§¯åˆ†ã€‚
                        </div>
                        <button class="btn btn-primary">å¼€å§‹æ¸¸æˆ</button>
                    </div>
                </div>
                
                <div id="game-container" style="display: none; margin-top: 30px;"></div>
            </div>

            <!-- æ’è¡Œæ¦œé¡µé¢ -->
            <div id="page-rank" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="text-title">ğŸ† æ’è¡Œæ¦œ</h1>
                    <p class="text-subtitle">æŸ¥çœ‹å¹³å°æœ€æ´»è·ƒçš„å­¦éœ¸ä»¬</p>
                </div>
                
                <div class="rankings-container" id="rankings-container">
                    <!-- æ’è¡Œæ¦œä¼šåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                </div>
            </div>

            <!-- æŠ•ç¨¿ä¸­å¿ƒé¡µé¢ -->
            <div id="page-submit" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="text-title">ğŸ“ æŠ•ç¨¿ä¸­å¿ƒ</h1>
                    <p class="text-subtitle">åˆ†äº«ä½ çš„çŸ¥è¯†ï¼Œå¸®åŠ©å…¶ä»–è€ƒç”Ÿ</p>
                </div>
                
                <div class="submit-form">
                    <div class="form-section">
                        <h3>åŸºæœ¬ä¿¡æ¯</h3>
                        <div class="form-group">
                            <label class="form-label text-bold">ç§‘ç›®åˆ†ç±»ï¼ˆç‚¹å‡»é€‰æ‹©ï¼‰</label>
                            <div class="category-selector" id="category-selector">
                                <div class="category-option" data-category="chi">
                                    <div class="category-icon"><i class="fas fa-language"></i></div>
                                    <div>ä¸­å›½è¯­æ–‡</div>
                                </div>
                                <div class="category-option" data-category="eng">
                                    <div class="category-icon"><i class="fas fa-font"></i></div>
                                    <div>è‹±å›½è¯­æ–‡</div>
                                </div>
                                <div class="category-option" data-category="math">
                                    <div class="category-icon"><i class="fas fa-calculator"></i></div>
                                    <div>æ•°å­¦</div>
                                </div>
                                <div class="category-option" data-category="ls">
                                    <div class="category-icon"><i class="fas fa-globe-asia"></i></div>
                                    <div>é€šè¯†æ•™è‚²</div>
                                </div>
                                <div class="category-option" data-category="phy">
                                    <div class="category-icon"><i class="fas fa-atom"></i></div>
                                    <div>ç‰©ç†</div>
                                </div>
                                <div class="category-option" data-category="chem">
                                    <div class="category-icon"><i class="fas fa-flask"></i></div>
                                    <div>åŒ–å­¦</div>
                                </div>
                                <div class="category-option" data-category="bio">
                                    <div class="category-icon"><i class="fas fa-dna"></i></div>
                                    <div>ç”Ÿç‰©</div>
                                </div>
                                <div class="category-option" data-category="econ">
                                    <div class="category-icon"><i class="fas fa-chart-line"></i></div>
                                    <div>ç»æµ</div>
                                </div>
                                <div class="category-option" data-category="geo">
                                    <div class="category-icon"><i class="fas fa-mountain"></i></div>
                                    <div>åœ°ç†</div>
                                </div>
                                <div class="category-option" data-category="his">
                                    <div class="category-icon"><i class="fas fa-landmark"></i></div>
                                    <div>å†å²</div>
                                </div>
                                <div class="category-option" data-category="cit">
                                    <div class="category-icon"><i class="fas fa-handshake"></i></div>
                                    <div>å…¬æ°‘ä¸ç¤¾ä¼š</div>
                                </div>
                                <div class="category-option" data-category="bafs">
                                    <div class="category-icon"><i class="fas fa-building"></i></div>
                                    <div>ä¼ä¸šã€ä¼šè®¡ä¸è´¢åŠ¡</div>
                                </div>
                                <div class="category-option" data-category="ict">
                                    <div class="category-icon"><i class="fas fa-laptop-code"></i></div>
                                    <div>èµ„è®¯ç§‘æŠ€</div>
                                </div>
                                <div class="category-option" data-category="va">
                                    <div class="category-icon"><i class="fas fa-palette"></i></div>
                                    <div>è§†è§‰è‰ºæœ¯</div>
                                </div>
                                <div class="category-option" data-category="music">
                                    <div class="category-icon"><i class="fas fa-music"></i></div>
                                    <div>éŸ³ä¹</div>
                                </div>
                                <div class="category-option" data-category="pe">
                                    <div class="category-icon"><i class="fas fa-running"></i></div>
                                    <div>ä½“è‚²</div>
                                </div>
                            </div>
                            <input type="hidden" id="submit-category" value="">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label text-bold">çŸ¥è¯†æ ‡é¢˜</label>
                            <input type="text" class="form-input" id="submit-title" placeholder="è¯·è¾“å…¥çŸ¥è¯†ç‚¹æ ‡é¢˜" maxlength="100">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>çŸ¥è¯†å†…å®¹</h3>
                        <div class="form-group">
                            <label class="form-label text-bold">è¯¦ç»†è§£é‡Š</label>
                            <textarea class="form-textarea" id="submit-content" 
                                      placeholder="è¯¦ç»†è§£é‡Šè¿™ä¸ªçŸ¥è¯†ç‚¹..." 
                                      rows="8"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label text-bold">ç¤ºä¾‹é¢˜ç›® (å¯é€‰)</label>
                            <textarea class="form-textarea" id="submit-example" 
                                      placeholder="æä¾›ä¸€ä¸ªç¤ºä¾‹é¢˜ç›®ï¼Œå¸®åŠ©ç†è§£..." 
                                      rows="4"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <button class="btn btn-primary btn-block" onclick="handleSubmitKnowledge()">
                            <i class="fas fa-paper-plane"></i> æäº¤å®¡æ ¸
                        </button>
                        <p id="submit-message" style="text-align: center; margin-top: 15px; font-size: 14px; color: var(--text-secondary);"></p>
                    </div>
                </div>
            </div>

            <!-- è®¾ç½®é¡µé¢ -->
            <div id="page-settings" class="page" style="display: none;">
                <div class="page-header">
                    <h1 class="text-title">âš™ï¸ ä¸ªäººè®¾ç½®</h1>
                    <p class="text-subtitle">ä¸ªæ€§åŒ–ä½ çš„å­¦ä¹ ä½“éªŒ</p>
                </div>
                
                <div class="form-section">
                    <h3>ä¸»é¢˜è®¾ç½®</h3>
                    <p class="readable-text-secondary" style="margin-bottom: 20px;">é€‰æ‹©ä½ å–œæ¬¢çš„é¢œè‰²ä¸»é¢˜</p>
                    <div class="theme-selector">
                        <div class="theme-option active" style="background: linear-gradient(135deg, #6366F1, #4F46E5);" onclick="changeTheme('default')" data-theme="default">é»˜è®¤</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #06B6D4, #0891B2);" onclick="changeTheme('ocean')" data-theme="ocean">æµ·æ´‹</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #10B981, #059669);" onclick="changeTheme('forest')" data-theme="forest">æ£®æ—</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #F97316, #EA580C);" onclick="changeTheme('sunset')" data-theme="sunset">æ—¥è½</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED);" onclick="changeTheme('lavender')" data-theme="lavender">è–°è¡£è‰</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #EC4899, #DB2777);" onclick="changeTheme('coral')" data-theme="coral">çŠç‘š</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #3B82F6, #2563EB);" onclick="changeTheme('sky')" data-theme="sky">å¤©ç©º</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #0D9488, #0F766E);" onclick="changeTheme('mint')" data-theme="mint">è–„è·</div>
                        <div class="theme-option" style="background: linear-gradient(135deg, #1E293B, #0F172A);" onclick="changeTheme('dark')" data-theme="dark">æ·±è‰²</div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>è´¦æˆ·ä¿¡æ¯</h3>
                    <div class="user-info" style="margin-top: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div class="user-avatar" id="settings-avatar" style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 20px;">U</div>
                            <div>
                                <div class="text-bold" style="font-size: 18px;" id="settings-username">ç”¨æˆ·å</div>
                                <div class="readable-text-secondary" style="font-size: 14px;" id="settings-email">é‚®ç®±</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div class="glass-card" style="text-align: center; background: var(--glass-bg); border-radius: var(--radius-lg); padding: 20px; border: var(--glass-border);">
                                <div class="stat-value" id="settings-score">0</div>
                                <div class="readable-text-secondary" style="font-size: 14px;">å½“å‰ç§¯åˆ†</div>
                            </div>
                            <div class="glass-card" style="text-align: center; background: var(--glass-bg); border-radius: var(--radius-lg); padding: 20px; border: var(--glass-border);">
                                <div class="stat-value" style="font-size: 24px; font-weight: 900; color: var(--success);" id="settings-games">0</div>
                                <div class="readable-text-secondary" style="font-size: 14px;">æ¸¸æˆæ¬¡æ•°</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç®¡ç†åå°é¡µé¢ -->
            <div id="page-admin" class="page" style="display: none;">
                <div class="page-header">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #F59E0B, #D97706); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-shield-alt" style="color: white; font-size: 28px;"></i>
                        </div>
                        <div>
                            <h1 class="text-title" style="color: #F59E0B;">ğŸ›¡ ç®¡ç†åå°</h1>
                            <p class="text-subtitle">å…¨é¢ç®¡ç†å¹³å°å†…å®¹ï¼Œç»´æŠ¤ç¤¾åŒºç§©åº</p>
                        </div>
                    </div>
                </div>
                
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="loadAdminTab(event, 'knowledge')">
                        <i class="fas fa-book"></i> çŸ¥è¯†ç®¡ç†
                        <span class="badge" id="pending-badge">0</span>
                    </button>
                    <button class="admin-tab" onclick="loadAdminTab(event, 'reports')">
                        <i class="fas fa-flag"></i> ä¸¾æŠ¥å¤„ç†
                        <span class="badge" id="reports-badge">0</span>
                    </button>
                    <button class="admin-tab" onclick="loadAdminTab(event, 'messages')">
                        <i class="fas fa-comments"></i> ç•™è¨€ç®¡ç†
                    </button>
                    <button class="admin-tab" onclick="loadAdminTab(event, 'users')">
                        <i class="fas fa-users"></i> ç”¨æˆ·ç®¡ç†
                    </button>
                    <button class="admin-tab" onclick="loadAdminTab(event, 'all-content')">
                        <i class="fas fa-archive"></i> å…¨éƒ¨å†…å®¹
                    </button>
                </div>
                
                <div id="admin-content" class="admin-content">
                    <!-- ç®¡ç†å‘˜å†…å®¹ä¼šåŠ¨æ€åŠ è½½åˆ°è¿™é‡Œ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================= é…ç½® =================
        const SUPABASE_URL = 'https://alsalyskulozwakhmzoa.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_SYzZpjbWZgKUzzGQxR-jGg_B1em-5Tr';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ================= å…¨å±€å˜é‡ =================
        let currentUser = null;
        let userProfile = null;
        let currentCategory = 'all';
        let selectedGameCategories = ['chi', 'eng', 'math', 'ls'];
        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let gameScore = 0;
        let selectedDifficulty = 'medium';
        let questionCount = 10;

        // ================= ç§‘ç›®å›¾æ ‡æ˜ å°„ =================
        const categoryIcons = {
            'chi': 'fas fa-language',
            'eng': 'fas fa-font',
            'math': 'fas fa-calculator',
            'ls': 'fas fa-globe-asia',
            'phy': 'fas fa-atom',
            'chem': 'fas fa-flask',
            'bio': 'fas fa-dna',
            'econ': 'fas fa-chart-line',
            'geo': 'fas fa-mountain',
            'his': 'fas fa-landmark',
            'cit': 'fas fa-handshake',
            'bafs': 'fas fa-building',
            'ict': 'fas fa-laptop-code',
            'va': 'fas fa-palette',
            'music': 'fas fa-music',
            'pe': 'fas fa-running'
        };

        // ================= æœ¬åœ°DSEçŸ¥è¯†ç‚¹åº“ =================
        const localDSEKnowledge = {
            'chi': [
                {
                    id: 'chi1',
                    title: 'ä¿®è¾æ‰‹æ³•ï¼šæ¯”å–»',
                    content: 'æ¯”å–»æ˜¯é€šè¿‡ä¸¤ç±»ä¸åŒäº‹ç‰©çš„ç›¸ä¼¼ç‚¹ï¼Œç”¨ä¸€äº‹ç‰©æ¥æå†™æˆ–è¯´æ˜å¦ä¸€äº‹ç‰©çš„ä¿®è¾æ‰‹æ³•ã€‚åŸºæœ¬ç»“æ„ï¼šæœ¬ä½“ + å–»è¯ + å–»ä½“ã€‚',
                    example: 'å¥¹çš„çœ¼ç›åƒæ˜Ÿæ˜Ÿä¸€æ ·æ˜äº®ã€‚',
                    answer: 'æ¯”å–»å¥',
                    difficulty: 'easy'
                },
                {
                    id: 'chi2',
                    title: 'æ–‡è¨€æ–‡è™šè¯ï¼šä¹‹',
                    content: 'â€œä¹‹â€åœ¨æ–‡è¨€æ–‡ä¸­å¸¸ç”¨ä½œä»£è¯ã€åŠ©è¯ã€åŠ¨è¯ã€‚ä½œä»£è¯æ—¶ç›¸å½“äº"ä»–/å¥¹/å®ƒ"ï¼›ä½œåŠ©è¯ç›¸å½“äº"çš„"ï¼›ä½œåŠ¨è¯ç›¸å½“äº"å»ã€å¾€"ã€‚',
                    example: 'å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦è¯´ä¹ï¼Ÿ',
                    answer: 'ä»£è¯ï¼ŒæŒ‡ä»£å­¦ä¹ çš„å†…å®¹',
                    difficulty: 'medium'
                }
            ],
            'eng': [
                {
                    id: 'eng1',
                    title: 'Present Perfect Tense',
                    content: 'ç°åœ¨å®Œæˆæ—¶è¡¨ç¤ºè¿‡å»å‘ç”Ÿçš„åŠ¨ä½œå¯¹ç°åœ¨é€ æˆçš„å½±å“æˆ–ç»“æœï¼Œæˆ–è¿‡å»å¼€å§‹æŒç»­åˆ°ç°åœ¨çš„åŠ¨ä½œã€‚ç»“æ„ï¼šhave/has + è¿‡å»åˆ†è¯ã€‚',
                    example: 'I have finished my homework.',
                    answer: 'Present Perfect',
                    difficulty: 'medium'
                }
            ],
            'math': [
                {
                    id: 'math1',
                    title: 'äºŒæ¬¡å‡½æ•°å›¾åƒ',
                    content: 'äºŒæ¬¡å‡½æ•° y = axÂ² + bx + c çš„å›¾åƒæ˜¯ä¸€æ¡æŠ›ç‰©çº¿ã€‚å½“a>0æ—¶å¼€å£å‘ä¸Šï¼Œa<0æ—¶å¼€å£å‘ä¸‹ã€‚',
                    example: 'y = xÂ² - 4x + 3 çš„é¡¶ç‚¹åæ ‡æ˜¯ä»€ä¹ˆï¼Ÿ',
                    answer: '(2, -1)',
                    difficulty: 'hard'
                }
            ],
            'ls': [
                {
                    id: 'ls1',
                    title: 'å¯æŒç»­å‘å±•',
                    content: 'å¯æŒç»­å‘å±•æ˜¯æŒ‡æ—¢èƒ½æ»¡è¶³å½“ä»£äººçš„éœ€æ±‚ï¼Œåˆä¸æŸå®³åä»£äººæ»¡è¶³å…¶éœ€æ±‚çš„èƒ½åŠ›çš„å‘å±•æ¨¡å¼ã€‚',
                    example: 'é¦™æ¸¯åœ¨å¯æŒç»­å‘å±•æ–¹é¢é¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ',
                    answer: 'åœŸåœ°èµ„æºç´§å¼ ã€äººå£å¯†åº¦é«˜ã€ç©ºæ°”æ±¡æŸ“ç­‰',
                    difficulty: 'medium'
                }
            ],
            'phy': [
                {
                    id: 'phy1',
                    title: 'ç‰›é¡¿è¿åŠ¨å®šå¾‹',
                    content: 'ç¬¬ä¸€å®šå¾‹ï¼šæƒ¯æ€§å®šå¾‹ï¼›ç¬¬äºŒå®šå¾‹ï¼šF=maï¼›ç¬¬ä¸‰å®šå¾‹ï¼šä½œç”¨åŠ›ä¸åä½œç”¨åŠ›ã€‚',
                    example: 'ä¸€ä¸ª5kgçš„ç‰©ä½“å—åˆ°10Nçš„åŠ›ï¼ŒåŠ é€Ÿåº¦æ˜¯å¤šå°‘ï¼Ÿ',
                    answer: '2 m/sÂ²',
                    difficulty: 'medium'
                }
            ],
            'chem': [
                {
                    id: 'chem1',
                    title: 'åŒ–å­¦é”®ç±»å‹',
                    content: 'ç¦»å­é”®ï¼šé‡‘å±ä¸éé‡‘å±ä¹‹é—´ï¼›å…±ä»·é”®ï¼šéé‡‘å±ä¸éé‡‘å±ä¹‹é—´ï¼›é‡‘å±é”®ï¼šé‡‘å±åŸå­ä¹‹é—´ã€‚',
                    example: 'NaClä¸­çš„åŒ–å­¦é”®æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ',
                    answer: 'ç¦»å­é”®',
                    difficulty: 'easy'
                }
            ],
            'bio': [
                {
                    id: 'bio1',
                    title: 'ç»†èƒç»“æ„',
                    content: 'çœŸæ ¸ç»†èƒåŒ…å«ç»†èƒæ ¸ã€çº¿ç²’ä½“ã€å†…è´¨ç½‘ã€é«˜å°”åŸºä½“ç­‰ç»†èƒå™¨ã€‚åŸæ ¸ç»†èƒæ²¡æœ‰ç»†èƒæ ¸ã€‚',
                    example: 'çœŸæ ¸ç»†èƒå’ŒåŸæ ¸ç»†èƒçš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ',
                    answer: 'çœŸæ ¸ç»†èƒæœ‰ç»†èƒæ ¸ï¼ŒåŸæ ¸ç»†èƒæ²¡æœ‰',
                    difficulty: 'easy'
                }
            ],
            'econ': [
                {
                    id: 'econ1',
                    title: 'ä¾›æ±‚å®šå¾‹',
                    content: 'ä»·æ ¼ä¸Šå‡ï¼Œä¾›ç»™é‡å¢åŠ ï¼Œéœ€æ±‚é‡å‡å°‘ï¼›ä»·æ ¼ä¸‹é™ï¼Œä¾›ç»™é‡å‡å°‘ï¼Œéœ€æ±‚é‡å¢åŠ ã€‚',
                    example: 'å½“å•†å“ä»·æ ¼ä¸Šå‡æ—¶ï¼Œéœ€æ±‚é‡ä¼šå¦‚ä½•å˜åŒ–ï¼Ÿ',
                    answer: 'å‡å°‘',
                    difficulty: 'easy'
                }
            ],
            'geo': [
                {
                    id: 'geo1',
                    title: 'æ¿å—æ„é€ ç†è®º',
                    content: 'åœ°çƒè¡¨é¢åˆ†ä¸ºä¸ƒå¤§æ¿å—ï¼Œæ¿å—è¿åŠ¨å¯¼è‡´åœ°éœ‡ã€ç«å±±å’Œå±±è„‰å½¢æˆã€‚',
                    example: 'å–œé©¬æ‹‰é›…å±±è„‰æ˜¯ç”±å“ªä¸¤ä¸ªæ¿å—ç¢°æ’å½¢æˆçš„ï¼Ÿ',
                    answer: 'å°åº¦æ¿å—å’Œæ¬§äºšæ¿å—',
                    difficulty: 'medium'
                }
            ],
            'his': [
                {
                    id: 'his1',
                    title: 'é¸¦ç‰‡æˆ˜äº‰',
                    content: '1840-1842å¹´ï¼Œä¸­å›½ä¸è‹±å›½çš„æˆ˜äº‰ï¼Œç»“æœç­¾è®¢äº†ã€Šå—äº¬æ¡çº¦ã€‹ï¼Œé¦™æ¸¯å²›å‰²è®©ç»™è‹±å›½ã€‚',
                    example: 'é¸¦ç‰‡æˆ˜äº‰åç­¾è®¢çš„æ¡çº¦æ˜¯ä»€ä¹ˆï¼Ÿ',
                    answer: 'ã€Šå—äº¬æ¡çº¦ã€‹',
                    difficulty: 'medium'
                }
            ],
            'cit': [
                {
                    id: 'cit1',
                    title: 'ä¸€å›½ä¸¤åˆ¶',
                    content: 'ä¸­å›½å¯¹é¦™æ¸¯ã€æ¾³é—¨å®è¡Œçš„æ”¿ç­–ï¼Œä¿è¯è¿™äº›åœ°åŒºåŸæœ‰çš„èµ„æœ¬ä¸»ä¹‰åˆ¶åº¦å’Œç”Ÿæ´»æ–¹å¼50å¹´ä¸å˜ã€‚',
                    example: 'ä¸€å›½ä¸¤åˆ¶çš„åŸºæœ¬å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ',
                    answer: 'ä¸€ä¸ªå›½å®¶ï¼Œä¸¤ç§åˆ¶åº¦',
                    difficulty: 'easy'
                }
            ]
        };

        // ================= åˆå§‹åŒ– =================
        document.addEventListener('DOMContentLoaded', async () => {
            // åˆå§‹åŒ–ç§‘ç›®é€‰æ‹©
            initCategorySelector();
            initGameCategorySelector();
            initDifficultySelector();
            
            // æ£€æŸ¥ä¼šè¯
            const { data: session } = await supabaseClient.auth.getSession();
            if (session.session) {
                document.getElementById('resume-btn').style.display = 'inline-block';
            }
            
            // åŠ è½½ä¸»é¢˜
            const savedTheme = localStorage.getItem('dse-theme') || 'default';
            document.body.setAttribute('data-theme', savedTheme);
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-theme') === savedTheme) {
                    option.classList.add('active');
                }
            });
            
            setupChatShortcuts();
            loadLocalKnowledge();
        });

        // ================= æŠ•ç¨¿ç§‘ç›®é€‰æ‹©åˆå§‹åŒ– =================
        function initCategorySelector() {
            const selector = document.getElementById('category-selector');
            if (!selector) return;
            
            selector.addEventListener('click', function(e) {
                const option = e.target.closest('.category-option');
                if (!option) return;
                
                const category = option.getAttribute('data-category');
                document.getElementById('submit-category').value = category;
                
                // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                selector.querySelectorAll('.category-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // é€‰ä¸­å½“å‰é€‰é¡¹
                option.classList.add('selected');
            });
            
            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª
            const firstOption = selector.querySelector('.category-option');
            if (firstOption) {
                firstOption.classList.add('selected');
                document.getElementById('submit-category').value = firstOption.getAttribute('data-category');
            }
        }

        // ================= æ¸¸æˆç§‘ç›®é€‰æ‹©åˆå§‹åŒ– =================
        function initGameCategorySelector() {
            const selector = document.getElementById('game-category-selector');
            if (!selector) return;
            
            selector.addEventListener('click', function(e) {
                const option = e.target.closest('.game-category-option');
                if (!option) return;
                
                const category = option.getAttribute('data-category');
                
                if (option.classList.contains('selected')) {
                    option.classList.remove('selected');
                    const index = selectedGameCategories.indexOf(category);
                    if (index > -1) {
                        selectedGameCategories.splice(index, 1);
                    }
                } else {
                    option.classList.add('selected');
                    if (!selectedGameCategories.includes(category)) {
                        selectedGameCategories.push(category);
                    }
                }
                
                console.log('å·²é€‰æ‹©ç§‘ç›®:', selectedGameCategories);
            });
            
            // é»˜è®¤é€‰ä¸­å‰å››ä¸ªç§‘ç›®
            const defaultCategories = ['chi', 'eng', 'math', 'ls'];
            defaultCategories.forEach(cat => {
                const option = selector.querySelector(`[data-category="${cat}"]`);
                if (option) {
                    option.classList.add('selected');
                }
            });
        }

        // ================= éš¾åº¦é€‰æ‹©åˆå§‹åŒ– =================
        function initDifficultySelector() {
            const selector = document.querySelector('.difficulty-options');
            if (!selector) return;
            
            selector.addEventListener('click', function(e) {
                const option = e.target.closest('.difficulty-option');
                if (!option) return;
                
                selector.querySelectorAll('.difficulty-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                option.classList.add('selected');
                selectedDifficulty = option.getAttribute('data-difficulty');
            });
        }

        // ================= é¢˜ç›®æ•°é‡è°ƒæ•´ =================
        function changeQuestionCount(delta) {
            questionCount = Math.max(5, Math.min(50, questionCount + delta));
            document.getElementById('question-count').textContent = questionCount;
        }

        // ================= æ˜¾ç¤ºæ¸¸æˆè®¾ç½®é¢æ¿ =================
        function showGameSettings() {
            document.getElementById('games-list').style.display = 'none';
            document.getElementById('game-settings-panel').style.display = 'block';
        }

        // ================= æ”¹è¿›çš„çŸ¥è¯†é—®ç­”æ¸¸æˆ =================
        function startQuizGame() {
            if (!currentUser) {
                showMessage('è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            if (selectedGameCategories.length === 0) {
                showMessage('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç§‘ç›®', 'error');
                return;
            }
            
            let allQuestions = [];
            
            // åªä»é€‰å®šçš„ç§‘ç›®ä¸­æŠ½å–é¢˜ç›®
            selectedGameCategories.forEach(category => {
                if (localDSEKnowledge[category]) {
                    localDSEKnowledge[category].forEach(item => {
                        if (item.example && item.difficulty === selectedDifficulty) {
                            allQuestions.push({
                                question: item.example,
                                answer: item.answer || 'æŸ¥çœ‹çŸ¥è¯†ç‚¹',
                                explanation: item.content,
                                category: category,
                                difficulty: item.difficulty || 'medium'
                            });
                        }
                    });
                }
            });
            
            // å¦‚æœæ²¡æœ‰å¯¹åº”éš¾åº¦çš„é¢˜ç›®ï¼Œåˆ™é€‰æ‹©æ‰€æœ‰é¢˜ç›®
            if (allQuestions.length === 0) {
                selectedGameCategories.forEach(category => {
                    if (localDSEKnowledge[category]) {
                        localDSEKnowledge[category].forEach(item => {
                            if (item.example) {
                                allQuestions.push({
                                    question: item.example,
                                    answer: item.answer || 'æŸ¥çœ‹çŸ¥è¯†ç‚¹',
                                    explanation: item.content,
                                    category: category,
                                    difficulty: item.difficulty || 'medium'
                                });
                            }
                        });
                    }
                });
            }
            
            if (allQuestions.length < 5) {
                showMessage('é€‰å®šç§‘ç›®çš„é¢˜ç›®æ•°é‡ä¸è¶³ï¼Œæ— æ³•å¼€å§‹æ¸¸æˆ', 'warning');
                return;
            }
            
            gameQuestions = shuffleArray(allQuestions).slice(0, questionCount);
            currentQuestionIndex = 0;
            gameScore = 0;
            
            document.getElementById('games-list').style.display = 'grid';
            document.getElementById('game-settings-panel').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            renderQuizGame();
        }

        // ================= ç‚¹èµåŠŸèƒ½ =================
        async function handleLike(targetType, targetId) {
            if (!currentUser) {
                showMessage('è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            try {
                // æ£€æŸ¥æ˜¯å¦å·²ç»ç‚¹èµ
                const { data: existingLike, error: checkError } = await supabaseClient
                    .from('likes')
                    .select('id')
                    .eq('user_id', currentUser.id)
                    .eq('target_type', targetType)
                    .eq('target_id', targetId)
                    .single();
                
                if (checkError && checkError.code !== 'PGRST116') {
                    throw checkError;
                }
                
                if (existingLike) {
                    // å–æ¶ˆç‚¹èµ
                    await supabaseClient
                        .from('likes')
                        .delete()
                        .eq('id', existingLike.id);
                    
                    // æ›´æ–°ç‚¹èµæ•°
                    await updateLikeCount(targetType, targetId, -1);
                    
                    showMessage('å·²å–æ¶ˆç‚¹èµ', 'info');
                } else {
                    // æ·»åŠ ç‚¹èµ
                    await supabaseClient
                        .from('likes')
                        .insert({
                            user_id: currentUser.id,
                            target_type: targetType,
                            target_id: targetId
                        });
                    
                    // æ›´æ–°ç‚¹èµæ•°
                    await updateLikeCount(targetType, targetId, 1);
                    
                    showMessage('ç‚¹èµæˆåŠŸ', 'success');
                }
                
                // é‡æ–°åŠ è½½ç•™è¨€æˆ–å†…å®¹
                if (targetType === 'feedback') {
                    await loadChatMessages();
                }
                
            } catch (error) {
                console.error('ç‚¹èµæ“ä½œå¤±è´¥:', error);
                showMessage('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        async function updateLikeCount(targetType, targetId, delta) {
            const table = targetType === 'feedback' ? 'feedbacks' : 'submissions';
            
            try {
                // è·å–å½“å‰ç‚¹èµæ•°
                const { data: current, error } = await supabaseClient
                    .from(table)
                    .select('like_count')
                    .eq('id', targetId)
                    .single();
                
                if (error) throw error;
                
                const newCount = Math.max(0, (current.like_count || 0) + delta);
                
                await supabaseClient
                    .from(table)
                    .update({ like_count: newCount })
                    .eq('id', targetId);
                    
            } catch (error) {
                console.error('æ›´æ–°ç‚¹èµæ•°å¤±è´¥:', error);
            }
        }

        // ================= æ”¹è¿›çš„ç®¡ç†åå° =================
        async function loadAdminTab(event, tab) {
            if (!userProfile?.is_admin) {
                showMessage('æ— æƒè®¿é—®ç®¡ç†åå°', 'error');
                switchPage('home');
                return;
            }
            
            const container = document.getElementById('admin-content');
            const tabs = document.querySelectorAll('.admin-tab');
            tabs.forEach(t => t.classList.remove('active'));
            
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);"><i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...</div>';
            
            switch (tab) {
                case 'knowledge':
                    await loadAdminKnowledge();
                    break;
                case 'reports':
                    await loadAdminReports();
                    break;
                case 'messages':
                    await loadAdminMessages();
                    break;
                case 'users':
                    await loadAdminUsers();
                    break;
                case 'all-content':
                    await loadAllContent();
                    break;
            }
        }

        // ================= æ–°åŠŸèƒ½ï¼šå…¨éƒ¨å†…å®¹ç®¡ç† =================
        async function loadAllContent() {
            try {
                const [submissions, messages] = await Promise.all([
                    supabaseClient
                        .from('submissions')
                        .select('*')
                        .order('created_at', { ascending: false }),
                    
                    supabaseClient
                        .from('feedbacks')
                        .select('*')
                        .order('created_at', { ascending: false })
                ]);
                
                const container = document.getElementById('admin-content');
                
                let content = `
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px; color: var(--primary);">ğŸ“¦ å¹³å°å…¨éƒ¨å†…å®¹</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div style="text-align: center; background: var(--glass-bg); border-radius: var(--radius-lg); padding: 20px; border: var(--glass-border);">
                                <div style="font-size: 32px; font-weight: 900; color: var(--primary);">${submissions.data?.length || 0}</div>
                                <div class="readable-text-secondary" style="font-size: 14px;">æ€»æŠ•ç¨¿æ•°</div>
                            </div>
                            <div style="text-align: center; background: var(--glass-bg); border-radius: var(--radius-lg); padding: 20px; border: var(--glass-border);">
                                <div style="font-size: 32px; font-weight: 900; color: var(--info);">${messages.data?.length || 0}</div>
                                <div class="readable-text-secondary" style="font-size: 14px;">æ€»ç•™è¨€æ•°</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // æŠ•ç¨¿å†…å®¹
                content += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px; color: var(--primary);">ğŸ“ æ‰€æœ‰æŠ•ç¨¿</h3>
                        <div style="margin-bottom: 20px;">
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <button class="btn btn-small" onclick="filterContent('all')" style="background: rgba(99, 102, 241, 0.1); color: var(--primary);">å…¨éƒ¨</button>
                                <button class="btn btn-small" onclick="filterContent('pending')" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">å¾…å®¡æ ¸</button>
                                <button class="btn btn-small" onclick="filterContent('approved')" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">å·²é€šè¿‡</button>
                                <button class="btn btn-small" onclick="filterContent('rejected')" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);">å·²æ‹’ç»</button>
                            </div>
                        </div>
                        
                        <div id="all-submissions-content">
                            ${submissions.data?.map(sub => renderAllContentItem(sub)).join('') || '<p class="readable-text-secondary">æš‚æ— æŠ•ç¨¿</p>'}
                        </div>
                    </div>
                `;
                
                container.innerHTML = content;
                
            } catch (error) {
                console.error('åŠ è½½å…¨éƒ¨å†…å®¹å¤±è´¥:', error);
                container.innerHTML = '<div>åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
            }
        }

        function renderAllContentItem(submission) {
            const time = new Date(submission.created_at).toLocaleString('zh-HK');
            const statusBadge = submission.status === 'pending' ? 
                '<span class="status-badge status-pending">å¾…å®¡æ ¸</span>' :
                submission.status === 'approved' ? 
                '<span class="status-badge status-approved">å·²é€šè¿‡</span>' :
                '<span class="status-badge status-rejected">å·²æ‹’ç»</span>';
            
            return `
                <div class="admin-item" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                        <div>
                            <h4 class="text-bold" style="margin: 0 0 8px 0;">
                                ${submission.title}
                                ${statusBadge}
                            </h4>
                            <div class="readable-text-secondary" style="font-size: 13px;">
                                ä½œè€…ï¼š${submission.author_name} | åˆ†ç±»ï¼š${getCategoryName(submission.category)} | ${time}
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            ${submission.status !== 'approved' ? `
                                <button class="btn btn-small" onclick="approveSubmission('${submission.id}')" 
                                        style="background: rgba(16, 185, 129, 0.1); color: #10B981;">
                                    <i class="fas fa-check"></i> é€šè¿‡
                                </button>
                            ` : ''}
                            ${submission.status !== 'rejected' ? `
                                <button class="btn btn-small" onclick="rejectSubmission('${submission.id}')" 
                                        style="background: rgba(239, 68, 68, 0.1); color: #EF4444;">
                                    <i class="fas fa-times"></i> æ‹’ç»
                                </button>
                            ` : ''}
                            <button class="btn btn-small" onclick="deleteSubmission('${submission.id}')" 
                                    style="background: rgba(239, 68, 68, 0.1); color: #EF4444;">
                                <i class="fas fa-trash"></i> åˆ é™¤
                            </button>
                        </div>
                    </div>
                    <div class="readable-text-secondary" style="line-height: 1.6; background: rgba(0,0,0,0.03); padding: 15px; border-radius: var(--radius-md); margin-bottom: 15px;">
                        ${submission.content}
                    </div>
                </div>
            `;
        }

        async function deleteSubmission(submissionId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æŠ•ç¨¿å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) return;
            
            try {
                const { error } = await supabaseClient
                    .from('submissions')
                    .delete()
                    .eq('id', submissionId);
                
                if (error) {
                    showMessage('åˆ é™¤å¤±è´¥: ' + error.message, 'error');
                    return;
                }
                
                showMessage('æŠ•ç¨¿å·²åˆ é™¤', 'success');
                loadAdminTab(event, 'all-content');
                
            } catch (error) {
                console.error('åˆ é™¤æŠ•ç¨¿å¼‚å¸¸:', error);
                showMessage('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // ================= æ›´æ–°ç•™è¨€æ¿æ¸²æŸ“å‡½æ•°ï¼ˆåŠ å…¥ç‚¹èµï¼‰=================
        async function renderChatMessages(messages) {
            const container = document.getElementById('chat-messages');
            if (!container) return;
            
            if (!messages || messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment-slash" style="font-size: 56px; opacity: 0.2; margin-bottom: 20px;"></i>
                        <h3 style="margin-bottom: 10px; color: var(--text-secondary);">è¿˜æ²¡æœ‰ç•™è¨€</h3>
                        <p class="readable-text-secondary">å¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡ç•™è¨€å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            // è·å–å½“å‰ç”¨æˆ·çš„ç‚¹èµçŠ¶æ€
            let likedMessages = [];
            if (currentUser) {
                const { data: likes } = await supabaseClient
                    .from('likes')
                    .select('target_id')
                    .eq('user_id', currentUser.id)
                    .eq('target_type', 'feedback');
                
                likedMessages = likes?.map(like => like.target_id) || [];
            }
            
            container.innerHTML = messages.map(message => {
                const isLiked = likedMessages.includes(message.id);
                const likeCount = message.like_count || 0;
                
                return `
                    <div class="message" style="padding: 20px; background: var(--glass-bg); border-radius: var(--radius-lg); border-left: 4px solid var(--primary); animation: slideIn 0.3s ease;">
                        <div class="message-header">
                            <div class="message-author-info">
                                <span class="message-author text-bold" style="font-size: 16px;">${message.author_name}</span>
                            </div>
                            <div class="message-time readable-text-secondary" style="font-size: 13px;">
                                ${formatMessageTime(message.created_at)}
                            </div>
                        </div>
                        
                        <div class="message-text-box" style="background: white; border-radius: var(--radius-md); padding: 20px; margin-bottom: 15px; border: 1px solid rgba(0, 0, 0, 0.05);">
                            <div class="readable-text" style="color: #1F2937; line-height: 1.7;">${message.content}</div>
                        </div>
                        
                        <div class="message-actions" style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div style="display: flex; gap: 15px;">
                                <button class="like-btn ${isLiked ? 'liked' : ''}" 
                                        onclick="handleLike('feedback', '${message.id}')">
                                    <i class="fas fa-heart"></i>
                                    <span>${likeCount}</span>
                                </button>
                            </div>
                            
                            <div style="display: flex; gap: 15px;">
                                ${userProfile?.is_admin ? `
                                    <button class="btn btn-small" onclick="adminDeleteMessage('${message.id}')" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);">
                                        <i class="fas fa-trash"></i> åˆ é™¤
                                    </button>
                                ` : ''}
                                ${message.status === 'normal' ? `
                                    <button class="btn btn-small" onclick="handleReportMessage('${message.id}')" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);">
                                        <i class="fas fa-flag"></i> ä¸¾æŠ¥
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        // ================= ç®¡ç†åå°ç»Ÿè®¡æ›´æ–° =================
        async function updateAdminStats() {
            try {
                // è·å–å¾…å®¡æ ¸æ•°é‡
                const { count: pendingCount } = await supabaseClient
                    .from('submissions')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'pending');
                
                // è·å–ä¸¾æŠ¥æ•°é‡
                const { count: reportCount } = await supabaseClient
                    .from('feedbacks')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'reported');
                
                document.getElementById('pending-badge').textContent = pendingCount || 0;
                document.getElementById('reports-badge').textContent = reportCount || 0;
                
            } catch (error) {
                console.error('æ›´æ–°ç»Ÿè®¡å¤±è´¥:', error);
            }
        }

        // ================= å…¶ä»–åŸæœ‰å‡½æ•°ä¿æŒä¸å˜ =================
        // ... (åŸæœ‰çš„èº«ä»½éªŒè¯ã€ç”¨æˆ·èµ„æ–™ã€çŸ¥è¯†åº“ç³»ç»Ÿã€æŠ•ç¨¿ç³»ç»Ÿã€æ¸¸æˆç³»ç»Ÿç­‰å‡½æ•°ä¿æŒä¸å˜)
        
        // ================= å·¥å…·å‡½æ•° =================
        function formatMessageTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'åˆšåˆš';
            if (diffMins < 60) return `${diffMins}åˆ†é’Ÿå‰`;
            if (diffHours < 24) return `${diffHours}å°æ—¶å‰`;
            if (diffDays < 7) return `${diffDays}å¤©å‰`;
            
            return date.toLocaleDateString('zh-HK');
        }

        function showMessage(text, type) {
            const colors = {
                success: 'var(--success)',
                error: 'var(--danger)',
                warning: 'var(--warning)',
                info: 'var(--primary)'
            };
            
            const messageEl = document.createElement('div');
            messageEl.textContent = text;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 12px 24px;
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                z-index: 10000;
                animation: slideInRight 0.3s ease;
                font-weight: 700;
                max-width: 400px;
                backdrop-filter: blur(10px);
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => messageEl.remove(), 300);
            }, 3000);
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function getCategoryName(category) {
            const categories = {
                'chi': 'ä¸­å›½è¯­æ–‡',
                'eng': 'è‹±å›½è¯­æ–‡',
                'math': 'æ•°å­¦',
                'ls': 'é€šè¯†æ•™è‚²',
                'phy': 'ç‰©ç†',
                'chem': 'åŒ–å­¦',
                'bio': 'ç”Ÿç‰©',
                'econ': 'ç»æµ',
                'geo': 'åœ°ç†',
                'his': 'å†å²',
                'cit': 'å…¬æ°‘ä¸ç¤¾ä¼šå‘å±•ç§‘',
                'bafs': 'ä¼ä¸šã€ä¼šè®¡ä¸è´¢åŠ¡æ¦‚è®º',
                'ict': 'èµ„è®¯åŠé€šè®¯ç§‘æŠ€',
                'va': 'è§†è§‰è‰ºæœ¯',
                'music': 'éŸ³ä¹',
                'pe': 'ä½“è‚²'
            };
            return categories[category] || category;
        }

        // ================= åˆå§‹åŒ–è°ƒç”¨ =================
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('auth-modal').style.display = 'flex';
        });
    </script>
</body>
</html>
