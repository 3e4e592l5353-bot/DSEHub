<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSE Hub - 管理员中心</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            /* 设计规范中的色彩系统 */
            --primary-start: #667eea;
            --primary-end: #764ba2;
            --accent-color: #5a67d8;
            --accent-light: rgba(90, 103, 216, 0.1);
            --accent-dark: #4c51bf;
            --text-color: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --card-bg: rgba(255, 255, 255, 0.98);
            --border-color: rgba(102, 126, 234, 0.15);
            --hover-color: rgba(102, 126, 234, 0.06);
            
            /* 设计规范中的间距系统 */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 24px;
            
            /* 设计规范中的圆角系统 */
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 20px;
            
            /* 设计规范中的阴影系统 */
            --shadow-sm: 0 2px 8px rgba(102, 126, 234, 0.08);
            --shadow-md: 0 4px 16px rgba(102, 126, 234, 0.12);
            --shadow-lg: 0 8px 32px rgba(102, 126, 234, 0.16);
            --shadow-xl: 0 12px 48px rgba(102, 126, 234, 0.2);
            
            /* 设计规范中的动画系统 */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* 布局容器 */
        .admin-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* 侧边导航栏 */
        .side-nav {
            width: 260px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-right: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            height: 100vh;
            padding: var(--spacing-xl);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--spacing-xl);
        }

        .nav-section h3 {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-sm);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-md);
            color: var(--text-color);
            text-decoration: none;
            transition: all var(--transition-normal);
            cursor: pointer;
            margin-bottom: var(--spacing-xs);
        }

        .nav-item:hover, .nav-item.active {
            background: var(--hover-color);
            color: var(--accent-color);
            transform: translateX(4px);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        /* 快捷操作栏 */
        .quick-actions {
            margin-top: auto;
            background: var(--accent-light);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-lg);
        }

        .quick-btn {
            display: block;
            width: 100%;
            padding: var(--spacing-sm);
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            margin-bottom: var(--spacing-sm);
            text-align: center;
            text-decoration: none;
        }

        .quick-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            padding: var(--spacing-xl);
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            background: var(--card-bg);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-sm);
        }

        .header-title h1 {
            font-size: 24px;
            font-weight: 700;
        }

        .header-title p {
            color: var(--text-secondary);
            margin-top: var(--spacing-xs);
        }

        .admin-badge {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* 控制栏 */
        .control-bar {
            background: var(--card-bg);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg) var(--spacing-md) 40px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            font-size: 14px;
            transition: all var(--transition-normal);
        }

        .search-box i {
            position: absolute;
            left: var(--spacing-lg);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .filter-select {
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            background: white;
            color: var(--text-color);
            min-width: 200px;
            cursor: pointer;
        }

        /* 内容网格 */
        .content-grid {
            display: grid;
            gap: var(--spacing-xl);
        }

        /* 卡片样式 */
        .content-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
            border: 1px solid var(--border-color);
        }

        .content-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-lg);
        }

        .card-title h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .card-meta {
            display: flex;
            gap: var(--spacing-lg);
            color: var(--text-secondary);
            font-size: 14px;
        }

        .card-meta span {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .card-content {
            margin-bottom: var(--spacing-lg);
            line-height: 1.6;
        }

        .card-actions {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: flex-end;
        }

        /* 按钮样式 */
        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-lg);
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-height: 44px;
        }

        .btn-approve {
            background: linear-gradient(135deg, #48bb78, #319795);
            color: white;
        }

        .btn-reject {
            background: linear-gradient(135deg, #f56565, #ed8936);
            color: white;
        }

        .btn-review {
            background: linear-gradient(135deg, #4299e1, #667eea);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .status-badge {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .admin-container {
                padding: var(--spacing-lg);
            }
        }

        @media (max-width: 1024px) {
            .admin-container {
                flex-direction: column;
            }
            
            .side-nav {
                width: 100%;
                height: auto;
                position: static;
            }
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 24px;
            }
            
            .control-bar {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .card-header {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: var(--spacing-sm);
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .card-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- 侧边导航栏 -->
        <nav class="side-nav">
            <div class="logo">DSE Hub</div>
            
            <div class="nav-section">
                <h3>内容审核</h3>
                <div class="nav-item active" data-type="submissions">
                    <i class="fas fa-file-alt"></i>
                    <span>题目提交</span>
                </div>
                <div class="nav-item" data-type="questions">
                    <i class="fas fa-question-circle"></i>
                    <span>已发布题目</span>
                </div>
                <div class="nav-item" data-type="feedbacks">
                    <i class="fas fa-comments"></i>
                    <span>用户反馈</span>
                </div>
                <div class="nav-item" data-type="game_questions">
                    <i class="fas fa-gamepad"></i>
                    <span>游戏题目</span>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>用户管理</h3>
                <div class="nav-item" data-type="profiles">
                    <i class="fas fa-users"></i>
                    <span>用户账户</span>
                </div>
                <div class="nav-item" data-type="identities">
                    <i class="fas fa-user-shield"></i>
                    <span>身份验证</span>
                </div>
                <div class="nav-item" data-type="sessions">
                    <i class="fas fa-clock"></i>
                    <span>会话管理</span>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>系统监控</h3>
                <div class="nav-item" data-type="audit_logs">
                    <i class="fas fa-history"></i>
                    <span>审计日志</span>
                </div>
                <div class="nav-item" data-type="performance">
                    <i class="fas fa-chart-bar"></i>
                    <span>性能统计</span>
                </div>
            </div>
            
            <!-- 快捷操作栏 -->
            <div class="quick-actions">
                <h3>快捷操作</h3>
                <button class="quick-btn" id="quickNote">
                    <i class="fas fa-plus"></i> 新建笔记
                </button>
                <button class="quick-btn" id="refreshData">
                    <i class="fas fa-sync-alt"></i> 刷新数据
                </button>
                <button class="quick-btn" id="viewAllPending">
                    <i class="fas fa-filter"></i> 查看所有待审
                </button>
            </div>
        </nav>
        
        <!-- 主内容区 -->
        <main class="main-content">
            <header class="content-header">
                <div class="header-title">
                    <h1 id="pageTitle">内容审核中心</h1>
                    <p id="pageSubtitle">管理所有待审核和已审核的内容</p>
                </div>
                <div class="admin-badge">
                    <i class="fas fa-crown"></i>
                    <span>管理员：独断万古</span>
                </div>
            </header>
            
            <!-- 控制栏 -->
            <div class="control-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="搜索内容、用户或关键词...">
                </div>
                <select class="filter-select" id="statusFilter">
                    <option value="all">所有状态</option>
                    <option value="pending">待审核</option>
                    <option value="approved">已通过</option>
                    <option value="rejected">已拒绝</option>
                </select>
                <select class="filter-select" id="typeFilter">
                    <option value="all">所有类型</option>
                    <option value="submissions">题目提交</option>
                    <option value="questions">已发布题目</option>
                    <option value="feedbacks">用户反馈</option>
                    <option value="game_questions">游戏题目</option>
                </select>
            </div>
            
            <!-- 内容展示区 -->
            <div class="content-grid" id="contentContainer">
                <!-- 内容将通过JavaScript动态加载 -->
                <div class="loading-message" style="text-align: center; padding: 48px; color: var(--text-secondary);">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p style="margin-top: 16px;">正在加载内容...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- 新建笔记模态框 -->
    <div id="noteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; width: 90%; max-width: 600px; border-radius: var(--border-radius-xl); padding: var(--spacing-xl); box-shadow: var(--shadow-xl);">
            <h2 style="margin-bottom: var(--spacing-lg);">新建管理员笔记</h2>
            <textarea id="noteContent" style="width: 100%; height: 200px; padding: var(--spacing-md); border: 2px solid var(--border-color); border-radius: var(--border-radius-md); margin-bottom: var(--spacing-lg);" placeholder="在此记录重要的审核事项、系统问题或管理决策..."></textarea>
            <div style="display: flex; gap: var(--spacing-sm); justify-content: flex-end;">
                <button onclick="closeNoteModal()" style="padding: var(--spacing-sm) var(--spacing-md); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); background: white; cursor: pointer;">取消</button>
                <button onclick="saveNote()" style="padding: var(--spacing-sm) var(--spacing-md); background: linear-gradient(135deg, var(--primary-start), var(--primary-end)); color: white; border: none; border-radius: var(--border-radius-md); cursor: pointer;">保存笔记</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase配置
        const SUPABASE_URL = 'https://alsalyskulozwakhmzoa.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_SYzZpjbWZgKUzzGQxR-jGg_B1em-5Tr';
        
        // 状态管理
        let currentUser = null;
        let currentDataType = 'submissions';
        let allItems = [];
        let filteredItems = [];
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', async function() {
            await initializeApp();
            setupEventListeners();
        });
        
        // 初始化应用
        async function initializeApp() {
            // 检查管理员权限
            await checkAdminStatus();
            
            // 加载初始数据
            await loadData(currentDataType);
            
            // 更新页面标题
            updatePageTitle();
        }
        
        // 检查管理员权限
        async function checkAdminStatus() {
            try {
                // 从profiles表获取当前用户
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles?select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const profiles = await response.json();
                    // 在实际应用中，这里应该基于实际登录用户
                    // 目前假设第一个is_admin=true的用户是管理员
                    currentUser = profiles.find(p => p.is_admin) || profiles[0];
                    
                    if (!currentUser || !currentUser.is_admin) {
                        showError('无管理员权限');
                    }
                }
            } catch (error) {
                console.error('检查权限时出错:', error);
                showError('无法验证管理员权限');
            }
        }
        
        // 加载数据
        async function loadData(dataType) {
            showLoading();
            
            try {
                let endpoint = '';
                let selectColumns = '*';
                
                // 根据数据类型设置端点
                switch(dataType) {
                    case 'submissions':
                        endpoint = 'submissions';
                        selectColumns = 'id,title,content,status,user_id,author_name,created_at,game_type,difficulty,like_count';
                        break;
                    case 'questions':
                        endpoint = 'questions';
                        selectColumns = 'id,title,content,status,author_id,author_name,created_at,game_type,difficulty,play_count';
                        break;
                    case 'feedbacks':
                        endpoint = 'feedbacks';
                        selectColumns = 'id,content,status,user_id,author_name,created_at,visibility,like_count';
                        break;
                    case 'game_questions':
                        endpoint = 'game_questions';
                        selectColumns = 'id,title,content,status,user_id,author_name,created_at,game_type';
                        break;
                    case 'profiles':
                        endpoint = 'profiles';
                        selectColumns = 'id,username,email,is_admin,score,games_played,created_at';
                        break;
                    case 'audit_logs':
                        endpoint = 'audit_log_entries';
                        selectColumns = 'id,ip_address,created_at,payload';
                        break;
                    default:
                        endpoint = 'submissions';
                }
                
                // 从Supabase获取数据
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/${endpoint}?select=${selectColumns}&order=created_at.desc`, 
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );
                
                if (response.ok) {
                    allItems = await response.json();
                    applyFilters();
                } else {
                    throw new Error(`API错误: ${response.status}`);
                }
            } catch (error) {
                console.error('加载数据时出错:', error);
                showError(`无法加载${getDataTypeName(currentDataType)}数据`);
                allItems = [];
                applyFilters();
            }
        }
        
        // 应用筛选
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            
            // 筛选数据
            filteredItems = allItems.filter(item => {
                // 状态筛选
                if (statusFilter !== 'all' && item.status !== statusFilter) {
                    return false;
                }
                
                // 类型筛选
                if (typeFilter !== 'all' && currentDataType !== typeFilter) {
                    // 如果类型筛选与当前数据类型不匹配，跳过此项
                    return false;
                }
                
                // 搜索筛选
                if (searchQuery) {
                    const searchableText = [
                        item.title || '',
                        item.content || '',
                        item.author_name || '',
                        item.username || '',
                        item.email || ''
                    ].join(' ').toLowerCase();
                    
                    if (!searchableText.includes(searchQuery)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            renderItems();
        }
        
        // 渲染项目
        function renderItems() {
            const container = document.getElementById('contentContainer');
            
            if (filteredItems.length === 0) {
                container.innerHTML = `
                    <div class="content-card" style="text-align: center; padding: 48px;">
                        <i class="fas fa-inbox fa-3x" style="color: var(--text-muted); margin-bottom: 16px;"></i>
                        <h3>没有找到内容</h3>
                        <p style="color: var(--text-secondary);">当前筛选条件下没有匹配的内容</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredItems.forEach(item => {
                const statusText = getStatusText(item.status);
                const statusClass = getStatusClass(item.status);
                const itemType = getItemType(item);
                const createdAt = formatDate(item.created_at);
                const previewContent = (item.content || '').substring(0, 150) + ((item.content || '').length > 150 ? '...' : '');
                
                html += `
                    <div class="content-card" data-id="${item.id}" data-type="${currentDataType}">
                        <div class="card-header">
                            <div class="card-title">
                                <h3>${item.title || item.username || '未命名项目'}</h3>
                                <div class="card-meta">
                                    <span><i class="far fa-user"></i> ${item.author_name || item.username || '匿名用户'}</span>
                                    <span><i class="far fa-calendar"></i> ${createdAt}</span>
                                    <span><i class="fas fa-tag"></i> ${itemType}</span>
                                </div>
                            </div>
                            <div class="status-badge ${statusClass}">${statusText}</div>
                        </div>
                        
                        <div class="card-content">
                            <p>${previewContent}</p>
                            ${item.game_type ? `<p><strong>游戏类型:</strong> ${item.game_type}</p>` : ''}
                            ${item.difficulty ? `<p><strong>难度:</strong> ${item.difficulty}</p>` : ''}
                            ${item.email ? `<p><strong>邮箱:</strong> ${item.email}</p>` : ''}
                        </div>
                        
                        <div class="card-actions">
                            ${item.status !== 'approved' ? `
                                <button class="btn btn-approve" onclick="approveItem('${currentDataType}', '${item.id}')">
                                    <i class="fas fa-check"></i> 通过
                                </button>
                            ` : ''}
                            
                            ${item.status !== 'rejected' ? `
                                <button class="btn btn-reject" onclick="rejectItem('${currentDataType}', '${item.id}')">
                                    <i class="fas fa-times"></i> 拒绝
                                </button>
                            ` : ''}
                            
                            <button class="btn btn-review" onclick="reviewItem('${currentDataType}', '${item.id}')">
                                <i class="fas fa-redo"></i> 复审
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // 批准项目
        async function approveItem(dataType, itemId) {
            if (!confirm('确定要通过此内容吗？')) return;
            
            try {
                const endpoint = getEndpoint(dataType);
                const response = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}?id=eq.${itemId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        status: 'approved',
                        updated_at: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    showSuccess('内容已通过审核');
                    await loadData(currentDataType);
                } else {
                    throw new Error('更新失败');
                }
            } catch (error) {
                console.error('批准内容时出错:', error);
                showError('操作失败');
            }
        }
        
        // 拒绝项目
        async function rejectItem(dataType, itemId) {
            if (!confirm('确定要拒绝此内容吗？')) return;
            
            try {
                const endpoint = getEndpoint(dataType);
                const response = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}?id=eq.${itemId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        status: 'rejected',
                        updated_at: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    showSuccess('内容已拒绝');
                    await loadData(currentDataType);
                } else {
                    throw new Error('更新失败');
                }
            } catch (error) {
                console.error('拒绝内容时出错:', error);
                showError('操作失败');
            }
        }
        
        // 复审项目
        async function reviewItem(dataType, itemId) {
            if (!confirm('确定要重新审核此内容吗？')) return;
            
            try {
                const endpoint = getEndpoint(dataType);
                const response = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}?id=eq.${itemId}`, {
                    method: 'PATCH',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        status: 'pending',
                        updated_at: new Date().toISOString()
                    })
                });
                
                if (response.ok) {
                    showSuccess('内容已标记为待复审');
                    await loadData(currentDataType);
                } else {
                    throw new Error('更新失败');
                }
            } catch (error) {
                console.error('复审内容时出错:', error);
                showError('操作失败');
            }
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 导航项点击
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', async () => {
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    currentDataType = item.dataset.type;
                    updatePageTitle();
                    await loadData(currentDataType);
                });
            });
            
            // 搜索输入
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            
            // 筛选器变更
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('typeFilter').addEventListener('change', applyFilters);
            
            // 快捷操作按钮
            document.getElementById('quickNote').addEventListener('click', openNoteModal);
            document.getElementById('refreshData').addEventListener('click', () => loadData(currentDataType));
            document.getElementById('viewAllPending').addEventListener('click', () => {
                document.getElementById('statusFilter').value = 'pending';
                applyFilters();
            });
        }
        
        // 新建笔记模态框
        function openNoteModal() {
            document.getElementById('noteModal').style.display = 'flex';
        }
        
        function closeNoteModal() {
            document.getElementById('noteModal').style.display = 'none';
            document.getElementById('noteContent').value = '';
        }
        
        function saveNote() {
            const noteContent = document.getElementById('noteContent').value;
            if (!noteContent.trim()) {
                alert('请输入笔记内容');
                return;
            }
            
            // 在实际应用中，这里应该保存到数据库
            // 目前先保存到本地存储
            const notes = JSON.parse(localStorage.getItem('admin_notes') || '[]');
            notes.push({
                content: noteContent,
                created_at: new Date().toISOString(),
                type: 'admin_note'
            });
            
            localStorage.setItem('admin_notes', JSON.stringify(notes));
            
            showSuccess('笔记已保存');
            closeNoteModal();
        }
        
        // 辅助函数
        function getDataTypeName(type) {
            const names = {
                'submissions': '题目提交',
                'questions': '已发布题目',
                'feedbacks': '用户反馈',
                'game_questions': '游戏题目',
                'profiles': '用户账户',
                'audit_logs': '审计日志'
            };
            
            return names[type] || '内容';
        }
        
        function getStatusText(status) {
            const statusMap = {
                'pending': '待审核',
                'approved': '已通过',
                'rejected': '已拒绝'
            };
            
            return statusMap[status] || '未知状态';
        }
        
        function getStatusClass(status) {
            const classMap = {
                'pending': 'status-pending',
                'approved': 'status-approved',
                'rejected': 'status-rejected'
            };
            
            return classMap[status] || 'status-pending';
        }
        
        function getItemType(item) {
            if (item.game_type) return item.game_type;
            if (currentDataType === 'profiles') return '用户账户';
            if (currentDataType === 'feedbacks') return '用户反馈';
            return '普通内容';
        }
        
        function getEndpoint(dataType) {
            const endpoints = {
                'submissions': 'submissions',
                'questions': 'questions',
                'feedbacks': 'feedbacks',
                'game_questions': 'game_questions',
                'profiles': 'profiles',
                'audit_logs': 'audit_log_entries'
            };
            
            return endpoints[dataType] || 'submissions';
        }
        
        function formatDate(dateString) {
            if (!dateString) return '未知日期';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
        }
        
        function updatePageTitle() {
            document.getElementById('pageTitle').textContent = `${getDataTypeName(currentDataType)}管理`;
            document.getElementById('pageSubtitle').textContent = `管理所有${getDataTypeName(currentDataType)}的审核状态`;
        }
        
        function showLoading() {
            const container = document.getElementById('contentContainer');
            container.innerHTML = `
                <div class="content-card" style="text-align: center; padding: 48px;">
                    <i class="fas fa-spinner fa-spin fa-2x" style="color: var(--accent-color); margin-bottom: 16px;"></i>
                    <h3>正在加载数据...</h3>
                    <p style="color: var(--text-secondary);">请稍候</p>
                </div>
            `;
        }
        
        function showSuccess(message) {
            // 在实际应用中，这里可以使用更优雅的通知
            alert(`✅ ${message}`);
        }
        
        function showError(message) {
            alert(`❌ ${message}`);
        }
    </script>
</body>
</html>
