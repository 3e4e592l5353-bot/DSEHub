<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•ç¨¿ä¸­å¿ƒ - DSEHub</title>
    <style>
        /* CSS æ ·å¼ä¿æŒä¸å˜ï¼Œä¸ä¹‹å‰çš„ä»£ç ç›¸åŒ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(-45deg, var(--primary-start), var(--primary-end));
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* è“ç´«è‰²ä¸»é¢˜ */
        .theme-blue-purple {
            --primary-start: #667eea;
            --primary-end: #764ba2;
            --accent-color: #5a67d8;
            --accent-light: rgba(90, 103, 216, 0.1);
            --accent-dark: #4c51bf;
            --text-color: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: rgba(102, 126, 234, 0.15);
            --border-color: rgba(102, 126, 234, 0.2);
        }

        /* ç»¿é’è‰²ä¸»é¢˜ */
        .theme-green-teal {
            --primary-start: #48bb78;
            --primary-end: #319795;
            --accent-color: #38a169;
            --accent-light: rgba(56, 161, 105, 0.1);
            --accent-dark: #2f855a;
            --text-color: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: rgba(72, 187, 120, 0.15);
            --border-color: rgba(72, 187, 120, 0.2);
        }

        /* æ©™çº¢è‰²ä¸»é¢˜ */
        .theme-orange-red {
            --primary-start: #ff8c00;
            --primary-end: #ff4500;
            --accent-color: #ff4500;
            --accent-light: rgba(255, 69, 0, 0.1);
            --accent-dark: #e03e00;
            --text-color: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: rgba(255, 140, 0, 0.15);
            --border-color: rgba(255, 140, 0, 0.2);
        }

        /* æ·±è‰²ä¸»é¢˜ */
        .theme-dark {
            --primary-start: #4a5568;
            --primary-end: #2d3748;
            --accent-color: #4299e1;
            --accent-light: rgba(66, 153, 225, 0.15);
            --accent-dark: #3182ce;
            --text-color: #e2e8f0;
            --text-secondary: #a0aec0;
            --text-muted: #718096;
            --card-bg: rgba(45, 55, 72, 0.95);
            --card-shadow: rgba(0, 0, 0, 0.3);
            --border-color: rgba(74, 85, 104, 0.5);
        }

        /* æ©™é’è‰²ä¸»é¢˜ */
        .theme-orange-teal {
            --primary-start: #ff8c00;
            --primary-end: #319795;
            --accent-color: #38a169;
            --accent-light: rgba(56, 161, 105, 0.1);
            --accent-dark: #2f855a;
            --text-color: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: rgba(255, 140, 0, 0.15);
            --border-color: rgba(255, 140, 0, 0.2);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .header h1 {
            color: white;
            font-size: 2.2rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 8px 18px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* ç™»å½•/æ³¨å†Œè¡¨å• */
        .auth-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin: 50px auto;
            max-width: 400px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        .auth-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-color);
        }

        .auth-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 25px;
            background: var(--accent-light);
            padding: 6px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            box-shadow: 0 3px 10px var(--card-shadow);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .auth-link {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .auth-link a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-link a:hover {
            text-decoration: underline;
        }

        /* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
        .user-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .logout-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: var(--accent-light);
            color: var(--accent-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .logout-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        .user-stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stat-item {
            padding: 8px 12px;
            background: var(--accent-light);
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
            min-width: 110px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 25px;
            background: var(--card-bg);
            padding: 6px;
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .page-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .page-tab.active {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            box-shadow: 0 3px 10px var(--card-shadow);
        }

        /* æŠ•ç¨¿ç±»å‹åˆ‡æ¢ */
        .submission-type {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            background: var(--card-bg);
            padding: 6px;
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--card-shadow);
            border: 1px solid var(--border-color);
        }

        .type-btn {
            flex: 1;
            min-width: 160px;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .type-btn.active {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            box-shadow: 0 3px 10px var(--card-shadow);
        }

        /* æŠ•ç¨¿è¡¨å•æ ·å¼ */
        .submission-form {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px var(--card-shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* ç§‘ç›®é€‰æ‹© */
        .subject-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 5px;
        }

        .subject-btn {
            padding: 6px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .subject-btn:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .subject-btn.selected {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            border-color: var(--primary-start);
        }

        /* æ ‡ç­¾é€‰æ‹© */
        .tag-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag-btn {
            padding: 5px 10px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .tag-btn:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .tag-btn.selected {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            border-color: var(--primary-start);
        }

        /* æ¸¸æˆç±»å‹é€‰æ‹© */
        .game-type-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .game-type-btn {
            flex: 1;
            min-width: 140px;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .game-type-btn:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            background: var(--accent-light);
        }

        .game-type-btn.selected {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            border-color: var(--primary-start);
            box-shadow: 0 3px 10px var(--card-shadow);
        }

        /* çŸ¥è¯†ç‚¹é€‰æ‹© */
        .knowledge-selector {
            margin-bottom: 15px;
        }

        .knowledge-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .knowledge-btn {
            padding: 6px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .knowledge-btn:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .knowledge-btn.selected {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            border-color: var(--primary-start);
        }

        /* éš¾åº¦é€‰æ‹© */
        .difficulty-buttons {
            display: flex;
            gap: 8px;
            margin-top: 5px;
        }

        .difficulty-btn {
            padding: 6px 12px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .difficulty-btn:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .difficulty-btn.selected {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            border-color: var(--primary-start);
        }

        /* æäº¤æŒ‰é’® */
        .submit-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .user-info {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .user-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .user-stats {
                width: 100%;
            }
            
            .stat-item {
                flex: 1;
                min-width: 90px;
            }
            
            .game-type-buttons {
                flex-direction: column;
            }
            
            .game-type-btn {
                min-width: 100%;
            }
            
            .type-btn {
                min-width: 140px;
            }
        }

        @media (max-width: 480px) {
            .type-btn {
                min-width: 100%;
            }
            
            .subject-buttons, .tag-buttons {
                gap: 6px;
            }
            
            .subject-btn, .tag-btn, .knowledge-btn {
                font-size: 0.8rem;
                padding: 5px 8px;
            }
        }

        /* æ¶ˆæ¯æ ·å¼ */
        .message {
            padding: 10px 14px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }

        .message.success {
            border-left: 4px solid #48bb78;
            color: #2f855a;
        }

        .message.error {
            border-left: 4px solid #f56565;
            color: #c53030;
        }

        .message.warning {
            border-left: 4px solid #ed8936;
            color: #c05621;
        }

        .message.info {
            border-left: 4px solid #4299e1;
            color: #2b6cb0;
        }

        .hidden {
            display: none !important;
        }

        /* å­—æ•°ç»Ÿè®¡ */
        .word-count {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 5px;
        }

        .word-count.warning {
            color: #ed8936;
        }

        .word-count.error {
            color: #f56565;
        }

        /* æœç´¢æ¡† */
        .search-box {
            margin-bottom: 10px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 8px 35px 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        /* æ— çŸ¥è¯†ç‚¹æç¤º */
        .no-knowledge {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* æŠ•ç¨¿å†å²æ ·å¼ */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px var(--card-shadow);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .history-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(237, 137, 54, 0.1);
            color: #c05621;
            border: 1px solid rgba(237, 137, 54, 0.3);
        }

        .status-approved {
            background: rgba(72, 187, 120, 0.1);
            color: #2f855a;
            border: 1px solid rgba(72, 187, 120, 0.3);
        }

        .status-rejected {
            background: rgba(245, 101, 101, 0.1);
            color: #c53030;
            border: 1px solid rgba(245, 101, 101, 0.3);
        }

        .history-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .history-content {
            color: var(--text-color);
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .history-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .history-tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .history-tag {
            padding: 2px 8px;
            background: var(--accent-light);
            border-radius: 10px;
            font-size: 0.75rem;
            color: var(--accent-color);
        }

        .no-history {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* è¿‡æ»¤å™¨å’Œæœç´¢ */
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .filter-btn:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
            color: white;
            border-color: var(--primary-start);
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ä¾‹å­è¯´æ˜ */
        .example-note {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 5px;
            padding: 8px;
            background: var(--accent-light);
            border-radius: 6px;
            border-left: 3px solid var(--accent-color);
        }

        .example-item {
            background: var(--accent-light);
            padding: 5px 10px;
            border-radius: 4px;
            margin: 3px 0;
            border-left: 3px solid var(--accent-color);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="theme-blue-purple">
    <!-- ç™»å½•/æ³¨å†Œç•Œé¢ -->
    <div id="authPage" class="container">
        <div class="header">
            <h1>ğŸ“š DSEHub æŠ•ç¨¿ä¸­å¿ƒ</h1>
            <p style="color: white; margin-top: 10px;">è¯·ç™»å½•æˆ–æ³¨å†Œä»¥å¼€å§‹æŠ•ç¨¿</p>
        </div>

        <div class="auth-card">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">
                    <i class="fas fa-sign-in-alt"></i> ç™»å½•
                </button>
                <button class="auth-tab" onclick="switchAuthTab('register')">
                    <i class="fas fa-user-plus"></i> æ³¨å†Œ
                </button>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <form id="loginForm" class="auth-form active">
                <div id="loginMessage" class="message hidden"></div>
                <div class="form-group">
                    <label class="form-label">é‚®ç®±</label>
                    <input type="email" class="form-control" id="loginEmail" 
                           placeholder="è¯·è¾“å…¥é‚®ç®±" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-control" id="loginPassword" 
                           placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-sign-in-alt"></i> ç™»å½•
                </button>
                <div class="auth-link">
                    è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ <a href="#" onclick="switchAuthTab('register'); return false;">ç«‹å³æ³¨å†Œ</a>
                </div>
            </form>

            <!-- æ³¨å†Œè¡¨å• -->
            <form id="registerForm" class="auth-form">
                <div id="registerMessage" class="message hidden"></div>
                <div class="form-group">
                    <label class="form-label">ç”¨æˆ·å</label>
                    <input type="text" class="form-control" id="registerUsername" 
                           placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                <div class="form-group">
                    <label class="form-label">é‚®ç®±</label>
                    <input type="email" class="form-control" id="registerEmail" 
                           placeholder="è¯·è¾“å…¥é‚®ç®±" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å¯†ç </label>
                    <input type="password" class="form-control" id="registerPassword" 
                           placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                <div class="form-group">
                    <label class="form-label">ç¡®è®¤å¯†ç </label>
                    <input type="password" class="form-control" id="registerConfirmPassword" 
                           placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-plus"></i> æ³¨å†Œ
                </button>
                <div class="auth-link">
                    å·²æœ‰è´¦å·ï¼Ÿ <a href="#" onclick="switchAuthTab('login'); return false;">ç«‹å³ç™»å½•</a>
                </div>
            </form>
        </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div id="mainPage" class="container" style="display: none;">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <div class="header">
            <h1>ğŸ“š DSEHub æŠ•ç¨¿ä¸­å¿ƒ</h1>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="openGames()">
                    <i class="fas fa-gamepad"></i> å°æ¸¸æˆ
                </button>
                <button class="nav-btn" onclick="openNotes()">
                    <i class="fas fa-sticky-note"></i> ç¬”è®°
                </button>
            </div>
        </div>

        <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
        <div class="user-card">
            <div class="user-info">
                <div>
                    <h2 id="username">ç”¨æˆ·</h2>
                    <p id="userEmail">é‚®ç®±</p>
                </div>
                <div class="user-actions">
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> ç™»å‡º
                    </button>
                </div>
            </div>
            <div class="user-stats">
                <div class="stat-item">
                    <div class="stat-label">æŠ•ç¨¿æ€»æ•°</div>
                    <div class="stat-value" id="submissionCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å®¡æ ¸é€šè¿‡</div>
                    <div class="stat-value" id="approvedCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ç­‰å¾…å®¡æ ¸</div>
                    <div class="stat-value" id="pendingCount">0</div>
                </div>
            </div>
        </div>

        <!-- é¡µé¢åˆ‡æ¢æ ‡ç­¾ -->
        <div class="page-tabs">
            <button class="page-tab active" onclick="switchPage('submit')">
                <i class="fas fa-upload"></i> æŠ•ç¨¿
            </button>
            <button class="page-tab" onclick="switchPage('history')">
                <i class="fas fa-history"></i> æŠ•ç¨¿å†å²
            </button>
        </div>

        <!-- æŠ•ç¨¿é¡µé¢ -->
        <div id="submitPage">
            <!-- æŠ•ç¨¿ç±»å‹åˆ‡æ¢ -->
            <div class="submission-type">
                <button class="type-btn active" onclick="switchType('knowledge')">
                    <i class="fas fa-graduation-cap"></i> çŸ¥è¯†ç‚¹æŠ•ç¨¿
                </button>
                <button class="type-btn" onclick="switchType('game')">
                    <i class="fas fa-gamepad"></i> å°æ¸¸æˆæŠ•ç¨¿
                </button>
            </div>

            <!-- çŸ¥è¯†ç‚¹æŠ•ç¨¿è¡¨å• -->
            <div id="knowledgeForm" class="submission-form">
                <div id="knowledgeMessage" class="message hidden"></div>
                <form id="knowledgeSubmissionForm">
                    <!-- ç§‘ç›®é€‰æ‹© -->
                    <div class="form-group">
                        <label class="form-label">é€‰æ‹©ç§‘ç›® *</label>
                        <div class="subject-buttons" id="subjectSelection">
                            <!-- ç§‘ç›®æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- æ ‡ç­¾é€‰æ‹© -->
                    <div class="form-group">
                        <label class="form-label">é€‰æ‹©æ ‡ç­¾ï¼ˆå¯å¤šé€‰ï¼‰</label>
                        <div class="tag-buttons" id="tagSelection">
                            <!-- æ ‡ç­¾æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- åç§° -->
                    <div class="form-group">
                        <label class="form-label">çŸ¥è¯†ç‚¹åç§° *</label>
                        <input type="text" class="form-control" id="knowledgeTitle" 
                               placeholder="è¯·è¾“å…¥çŸ¥è¯†ç‚¹åç§°" required>
                    </div>

                    <!-- å†…å®¹ -->
                    <div class="form-group">
                        <label class="form-label">çŸ¥è¯†ç‚¹ç®€è¿° (50-200å­—) *</label>
                        <textarea class="form-control textarea" id="knowledgeContent" 
                                  placeholder="è¯·ç®€è¦æè¿°çŸ¥è¯†ç‚¹å†…å®¹ï¼Œ50-200å­—..." 
                                  maxlength="200"></textarea>
                        <div class="word-count" id="knowledgeWordCount">0/200 å­—</div>
                        <div id="knowledgeError" class="message hidden" style="margin-top: 10px;"></div>
                    </div>

                    <button type="submit" class="submit-btn">
                        <i class="fas fa-paper-plane"></i> æäº¤çŸ¥è¯†ç‚¹æŠ•ç¨¿
                    </button>
                </form>
            </div>

            <!-- å°æ¸¸æˆæŠ•ç¨¿è¡¨å• -->
            <div id="gameForm" class="submission-form" style="display: none;">
                <div id="gameMessage" class="message hidden"></div>
                <form id="gameSubmissionForm">
                    <!-- æ¸¸æˆç±»å‹é€‰æ‹© -->
                    <div class="form-group">
                        <label class="form-label">é€‰æ‹©æ¸¸æˆç±»å‹ *</label>
                        <div class="game-type-buttons" id="gameTypeSelection">
                            <!-- æ¸¸æˆç±»å‹æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- çŸ¥è¯†ç‚¹é€‰æ‹© -->
                    <div class="form-group knowledge-selector">
                        <label class="form-label">é€‰æ‹©å…³è”çŸ¥è¯†ç‚¹ *</label>
                        <div class="search-box">
                            <input type="text" class="search-input" id="knowledgeSearch" 
                                   placeholder="æœç´¢çŸ¥è¯†ç‚¹...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                        <div class="knowledge-buttons" id="knowledgeSelection">
                            <div class="no-knowledge">è¾“å…¥å…³é”®è¯æœç´¢çŸ¥è¯†ç‚¹</div>
                        </div>
                        <input type="hidden" id="selectedKnowledgeId">
                        <input type="hidden" id="selectedKnowledgeTitle">
                    </div>

                    <!-- è¿è¿çœ‹æ¸¸æˆå†…å®¹ -->
                    <div id="matchGameContent" class="form-group" style="display: none;">
                        <label class="form-label">ä¾‹å­è¾“å…¥ *</label>
                        <textarea class="form-control textarea" id="matchExamples" 
                                  placeholder="è¯·è¾“å…¥ä¾‹å­ï¼Œæ¯è¡Œä¸€ä¸ªï¼š&#10;å¤ªé˜³åƒç«çƒ&#10;æœˆäº®åƒé“¶ç›˜&#10;æ˜Ÿæ˜Ÿåƒçç " 
                                  rows="6" required></textarea>
                        <div class="example-note">
                            <i class="fas fa-info-circle"></i> è¯·è¾“å…¥ç›¸å…³ä¾‹å­ï¼Œæ¯è¡Œä¸€ä¸ªã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ä»¥çŸ¥è¯†ç‚¹ä¸ºä¸»é¢˜ç”Ÿæˆé…å¯¹é¢˜ç›®ã€‚
                        </div>
                    </div>

                    <!-- å¯¹é”™åˆ¤æ–­æ¸¸æˆå†…å®¹ -->
                    <div id="trueFalseContent" class="form-group" style="display: none;">
                        <label class="form-label">é—®é¢˜é™ˆè¿° *</label>
                        <textarea class="form-control textarea" id="tfQuestion" 
                                  placeholder="è¯·è¾“å…¥éœ€è¦åˆ¤æ–­æ­£è¯¯çš„é™ˆè¿°..." 
                                  required></textarea>
                        
                        <div style="margin-top: 15px;">
                            <label class="form-label">æ­£ç¡®ç­”æ¡ˆ *</label>
                            <div class="tag-buttons" style="margin-top: 8px;">
                                <button type="button" class="tag-btn tf-answer" data-value="true">
                                    <i class="fas fa-check"></i> æ­£ç¡®
                                </button>
                                <button type="button" class="tag-btn tf-answer" data-value="false">
                                    <i class="fas fa-times"></i> é”™è¯¯
                                </button>
                            </div>
                            <input type="hidden" id="tfAnswer" required>
                        </div>
                    </div>

                    <!-- çŒœçŸ¥è¯†ç‚¹æ¸¸æˆå†…å®¹ -->
                    <div id="guessContent" class="form-group" style="display: none;">
                        <label class="form-label">æè¿°/æç¤º *</label>
                        <textarea class="form-control textarea" id="guessDescription" 
                                  placeholder="è¯·æè¿°è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œä½†ä¸ç›´æ¥è¯´å‡ºåç§°..." 
                                  required></textarea>
                    </div>

                    <!-- éš¾åº¦é€‰æ‹© -->
                    <div class="form-group">
                        <label class="form-label">é€‰æ‹©éš¾åº¦ *</label>
                        <div class="difficulty-buttons">
                            <button type="button" class="difficulty-btn" data-value="easy">ç®€å•</button>
                            <button type="button" class="difficulty-btn" data-value="medium">ä¸­ç­‰</button>
                            <button type="button" class="difficulty-btn" data-value="hard">å›°éš¾</button>
                        </div>
                        <input type="hidden" id="gameDifficulty" required>
                    </div>

                    <button type="submit" class="submit-btn">
                        <i class="fas fa-paper-plane"></i> æäº¤æ¸¸æˆæŠ•ç¨¿
                    </button>
                </form>
            </div>
        </div>

        <!-- æŠ•ç¨¿å†å²é¡µé¢ -->
        <div id="historyPage" style="display: none;">
            <div class="submission-form">
                <h3 style="margin-bottom: 20px; color: var(--text-color);">æˆ‘çš„æŠ•ç¨¿å†å²</h3>
                
                <div class="filters">
                    <button class="filter-btn active" onclick="filterHistory('all')">å…¨éƒ¨</button>
                    <button class="filter-btn" onclick="filterHistory('knowledge')">çŸ¥è¯†ç‚¹</button>
                    <button class="filter-btn" onclick="filterHistory('game')">å°æ¸¸æˆ</button>
                    <button class="filter-btn" onclick="filterHistory('pending_review')">ç­‰å¾…å®¡æ ¸</button>
                    <button class="filter-btn" onclick="filterHistory('approved')">å®¡æ ¸é€šè¿‡</button>
                    <button class="filter-btn" onclick="filterHistory('rejected')">å®¡æ ¸æ‹’ç»</button>
                </div>
                
                <div class="history-list" id="historyList">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        åŠ è½½æŠ•ç¨¿å†å²...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase é…ç½®
        const SUPABASE_URL = 'https://alsalyskulozwakhmzoa.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_SYzZpjbWZgKUzzGQxR-jGg_B1em-5Tr';

        // ç§‘ç›®åˆ—è¡¨
        const subjects = [
            { id: 'chinese', name: 'ä¸­å›½è¯­æ–‡' },
            { id: 'english', name: 'è‹±å›½è¯­æ–‡' },
            { id: 'math', name: 'æ•°å­¦' },
            { id: 'math_extended1', name: 'æ•°å­¦å»¶ä¼¸å•å…ƒä¸€' },
            { id: 'math_extended2', name: 'æ•°å­¦å»¶ä¼¸å•å…ƒäºŒ' },
            { id: 'ls', name: 'å…¬æ°‘ä¸ç¤¾ä¼šå‘å±•' },
            { id: 'biology', name: 'ç”Ÿç‰©' },
            { id: 'chemistry', name: 'åŒ–å­¦' },
            { id: 'physics', name: 'ç‰©ç†' },
            { id: 'chinese_history', name: 'ä¸­å›½å†å²' },
            { id: 'history', name: 'å†å²' },
            { id: 'geography', name: 'åœ°ç†' },
            { id: 'economics', name: 'ç»æµ' },
            { id: 'chinese_literature', name: 'ä¸­å›½æ–‡å­¦' },
            { id: 'english_literature', name: 'è‹±å›½æ–‡å­¦' },
            { id: 'bafs', name: 'ä¼ä¸šã€ä¼šè®¡ä¸è´¢åŠ¡æ¦‚è®º' },
            { id: 'ict', name: 'èµ„è®¯åŠé€šè®¯æŠ€æœ¯' },
            { id: 'ers', name: 'ä¼¦ç†ä¸å®—æ•™' },
            { id: 'th', name: 'æ—…æ¸¸ä¸æ¬¾å¾…' },
            { id: 'da', name: 'è®¾è®¡ä¸åº”ç”¨' },
            { id: 'health', name: 'ç§‘æŠ€ä¸å¥åº·' },
            { id: 'management', name: 'ç®¡ç†ä¸ç¤¾ä¼šç§‘å­¦' },
            { id: 'technology_life', name: 'ç§‘æŠ€ä¸ç”Ÿæ´»' },
            { id: 'music', name: 'éŸ³ä¹' },
            { id: 'visual_arts', name: 'è§†è§‰è‰ºæœ¯' },
            { id: 'pe', name: 'ä½“è‚²' }
        ];

        // æ ‡ç­¾åˆ—è¡¨
        const tags = [
            { id: 'formula', name: 'å…¬å¼' },
            { id: 'grammar', name: 'è¯­æ³•' },
            { id: 'quote', name: 'åè¨€é‡‘å¥' },
            { id: 'idiom', name: 'æˆè¯­' },
            { id: 'term', name: 'æœ¯è¯­' },
            { id: 'basic', name: 'åŸºç¡€' },
            { id: 'advanced', name: 'è¿›é˜¶' }
        ];

        // æ¸¸æˆç±»å‹
        const gameTypes = [
            {
                id: 'matching',
                name: 'è¿è¿çœ‹',
                icon: 'fas fa-link',
                description: 'æ ¹æ®çŸ¥è¯†ç‚¹åŒ¹é…ä¾‹å­'
            },
            {
                id: 'true_false',
                name: 'å¯¹é”™åˆ¤æ–­',
                icon: 'fas fa-check-circle',
                description: 'åˆ¤æ–­é™ˆè¿°çš„æ­£è¯¯'
            },
            {
                id: 'guess',
                name: 'çŒœçŸ¥è¯†ç‚¹',
                icon: 'fas fa-lightbulb',
                description: 'æ ¹æ®æè¿°çŒœçŸ¥è¯†ç‚¹'
            }
        ];

        // ç”¨æˆ·æ•°æ®
        let currentUser = null;
        let currentTheme = 'theme-blue-purple';
        let availableKnowledge = [];
        let userSubmissions = [];
        let currentHistoryFilter = 'all';

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            setupEventListeners();
        });

        function checkLoginStatus() {
            const userData = getStoredUser();
            if (userData && userData.id) {
                currentUser = userData;
                showMainPage();
                initializeMainPage();
            } else {
                showAuthPage();
            }
        }

        function getStoredUser() {
            try {
                const userData = localStorage.getItem('dsehub_submission_user');
                if (userData) {
                    return JSON.parse(userData);
                }
            } catch (e) {
                console.error('è¯»å–ç”¨æˆ·æ•°æ®å¤±è´¥:', e);
            }
            return null;
        }

        function storeUser(userData) {
            localStorage.setItem('dsehub_submission_user', JSON.stringify(userData));
        }

        function clearStoredUser() {
            localStorage.removeItem('dsehub_submission_user');
        }

        function showAuthPage() {
            document.getElementById('authPage').style.display = 'block';
            document.getElementById('mainPage').style.display = 'none';
        }

        function showMainPage() {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        async function loginUser(email, password) {
            try {
                // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨äº profiles è¡¨
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/profiles?email=eq.${encodeURIComponent(email)}&select=id,username,email,theme_color,password_hash`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );

                if (response.ok) {
                    const profiles = await response.json();
                    
                    if (profiles && profiles.length > 0) {
                        const profile = profiles[0];
                        
                        // æ³¨æ„ï¼šè¿™é‡Œåº”è¯¥åœ¨å®é™…åº”ç”¨ä¸­éªŒè¯å¯†ç å“ˆå¸Œ
                        // ç›®å‰å…ˆå‡è®¾éªŒè¯é€šè¿‡
                        
                        // åˆ›å»ºç”¨æˆ·å¯¹è±¡
                        const userData = {
                            id: profile.id,
                            username: profile.username,
                            email: profile.email,
                            theme_color: profile.theme_color
                        };
                        
                        storeUser(userData);
                        currentUser = userData;
                        
                        showMainPage();
                        initializeMainPage();
                        
                        return true;
                    } else {
                        return false;
                    }
                } else {
                    console.error('ç™»å½•å¤±è´¥:', await response.text());
                    return false;
                }
            } catch (error) {
                console.error('ç™»å½•é”™è¯¯:', error);
                return false;
            }
        }

        async function registerUser(username, email, password) {
            try {
                // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
                const checkResponse = await fetch(
                    `${SUPABASE_URL}/rest/v1/profiles?email=eq.${encodeURIComponent(email)}&select=id`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );

                if (checkResponse.ok) {
                    const existingProfiles = await checkResponse.json();
                    
                    if (existingProfiles && existingProfiles.length > 0) {
                        return { success: false, message: 'é‚®ç®±å·²è¢«æ³¨å†Œ' };
                    }
                }

                // åˆ›å»ºæ–°ç”¨æˆ·profile
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email,
                        password_hash: password, // æ³¨æ„ï¼šå®é™…åº”ç”¨ä¸­åº”è¯¥ä½¿ç”¨bcryptç­‰åŠ å¯†
                        theme_color: 'blue-purple',
                        created_at: new Date().toISOString(),
                        updated_at: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    const newProfile = await response.json();
                    
                    const userData = {
                        id: newProfile[0].id,
                        username: username,
                        email: email,
                        theme_color: 'blue-purple'
                    };
                    
                    storeUser(userData);
                    currentUser = userData;
                    
                    return { success: true };
                } else {
                    return { success: false, message: 'æ³¨å†Œå¤±è´¥' };
                }
            } catch (error) {
                console.error('æ³¨å†Œé”™è¯¯:', error);
                return { success: false, message: 'æ³¨å†Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯' };
            }
        }

        function initializeMainPage() {
            initializePage();
            updateUserDisplay(currentUser);
            loadUserTheme();
            loadUserStats();
            loadKnowledgePoints();
        }

        function initializePage() {
            const subjectSelection = document.getElementById('subjectSelection');
            subjects.forEach(subject => {
                const btn = createButton('subject-btn', subject.id, subject.name, subjectSelection, true);
                subjectSelection.appendChild(btn);
            });

            const tagSelection = document.getElementById('tagSelection');
            tags.forEach(tag => {
                const btn = createButton('tag-btn', tag.id, tag.name, null, false);
                tagSelection.appendChild(btn);
            });

            const gameTypeSelection = document.getElementById('gameTypeSelection');
            gameTypes.forEach(game => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'game-type-btn';
                btn.dataset.type = game.id;
                btn.innerHTML = `<i class="${game.icon}"></i> ${game.name}`;
                btn.onclick = () => {
                    document.querySelectorAll('.game-type-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    showGameContent(game.id);
                };
                gameTypeSelection.appendChild(btn);
            });

            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('gameDifficulty').value = this.dataset.value;
                });
            });

            document.getElementById('knowledgeContent').addEventListener('input', function() {
                updateWordCount();
                validateKnowledgeContent();
            });

            document.getElementById('knowledgeSearch').addEventListener('input', searchKnowledge);
        }

        function createButton(className, id, text, container, isSingleSelect) {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = className;
            btn.dataset.id = id;
            btn.textContent = text;
            
            if (isSingleSelect) {
                btn.onclick = () => {
                    container.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                };
            } else {
                btn.onclick = () => {
                    btn.classList.toggle('selected');
                };
            }
            
            return btn;
        }

        async function loadUserTheme() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/profiles?id=eq.${currentUser.id}&select=theme_color`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );
                
                if (response.ok) {
                    const profiles = await response.json();
                    if (profiles && profiles.length > 0) {
                        const profile = profiles[0];
                        const themeColor = profile.theme_color;
                        
                        let themeClass = '';
                        
                        if (themeColor) {
                            if (themeColor.includes('blue') || themeColor.includes('purple')) {
                                themeClass = 'theme-blue-purple';
                            } else if (themeColor.includes('green') || themeColor.includes('teal')) {
                                themeClass = 'theme-green-teal';
                            } else if (themeColor.includes('orange') || themeColor.includes('red')) {
                                themeClass = 'theme-orange-red';
                            } else if (themeColor.includes('dark')) {
                                themeClass = 'theme-dark';
                            } else {
                                themeClass = 'theme-blue-purple';
                            }
                        } else {
                            themeClass = 'theme-blue-purple';
                        }
                        
                        currentTheme = themeClass;
                        document.body.className = themeClass;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·ä¸»é¢˜å¤±è´¥:', error);
            }
        }

        async function loadUserStats() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/submissions?user_id=eq.${currentUser.id}&select=id,category,status`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );
                
                if (response.ok) {
                    const submissions = await response.json();
                    userSubmissions = submissions || [];
                    
                    const total = userSubmissions.length;
                    const approved = userSubmissions.filter(s => s.status === 'approved').length;
                    const pending = userSubmissions.filter(s => s.status === 'pending_review').length;
                    
                    document.getElementById('submissionCount').textContent = total;
                    document.getElementById('approvedCount').textContent = approved;
                    document.getElementById('pendingCount').textContent = pending;
                }
            } catch (error) {
                console.log('åŠ è½½ç”¨æˆ·ç»Ÿè®¡å¤±è´¥:', error);
                document.getElementById('submissionCount').textContent = '0';
                document.getElementById('approvedCount').textContent = '0';
                document.getElementById('pendingCount').textContent = '0';
            }
        }

        function updateUserDisplay(user) {
            document.getElementById('username').textContent = user.username || 'ç”¨æˆ·';
            document.getElementById('userEmail').textContent = user.email || '';
        }

        function setupEventListeners() {
            // ç™»å½•è¡¨å•æäº¤
            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                
                if (!email || !password) {
                    showAuthMessage('error', 'è¯·å¡«å†™é‚®ç®±å’Œå¯†ç ', 'login');
                    return;
                }
                
                const submitBtn = e.target.querySelector('.auth-btn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ç™»å½•ä¸­...';
                submitBtn.disabled = true;
                
                try {
                    const success = await loginUser(email, password);
                    
                    if (success) {
                        showAuthMessage('success', 'ç™»å½•æˆåŠŸï¼', 'login');
                        setTimeout(() => {
                            showMainPage();
                            initializeMainPage();
                        }, 1000);
                    } else {
                        showAuthMessage('error', 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ', 'login');
                    }
                } catch (error) {
                    showAuthMessage('error', 'ç™»å½•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'login');
                } finally {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });

            // æ³¨å†Œè¡¨å•æäº¤
            document.getElementById('registerForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('registerUsername').value.trim();
                const email = document.getElementById('registerEmail').value.trim();
                const password = document.getElementById('registerPassword').value.trim();
                const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();
                
                if (!username || !email || !password || !confirmPassword) {
                    showAuthMessage('error', 'è¯·å¡«å†™æ‰€æœ‰å­—æ®µ', 'register');
                    return;
                }
                
                if (password.length < 6) {
                    showAuthMessage('error', 'å¯†ç è‡³å°‘éœ€è¦6ä½', 'register');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showAuthMessage('error', 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'register');
                    return;
                }
                
                const submitBtn = e.target.querySelector('.auth-btn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ³¨å†Œä¸­...';
                submitBtn.disabled = true;
                
                try {
                    const result = await registerUser(username, email, password);
                    
                    if (result.success) {
                        showAuthMessage('success', 'æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨ç™»å½•...', 'register');
                        setTimeout(() => {
                            showMainPage();
                            initializeMainPage();
                        }, 1500);
                    } else {
                        showAuthMessage('error', result.message || 'æ³¨å†Œå¤±è´¥', 'register');
                    }
                } catch (error) {
                    showAuthMessage('error', 'æ³¨å†Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯', 'register');
                } finally {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });

            // çŸ¥è¯†ç‚¹è¡¨å•æäº¤
            document.getElementById('knowledgeSubmissionForm').addEventListener('submit', submitKnowledge);
            
            // æ¸¸æˆè¡¨å•æäº¤
            document.getElementById('gameSubmissionForm').addEventListener('submit', submitGame);
            
            // å¯¹é”™åˆ¤æ–­ç­”æ¡ˆé€‰æ‹©
            document.querySelectorAll('.tf-answer').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tf-answer').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('tfAnswer').value = this.dataset.value;
                });
            });
        }

        function showAuthMessage(type, message, formId) {
            const messageDiv = document.getElementById(formId + 'Message');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <div>${message}</div>
            `;
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        function logout() {
            clearStoredUser();
            currentUser = null;
            showAuthPage();
        }

        // ä»¥ä¸‹æ˜¯åŸæœ‰çš„æŠ•ç¨¿ç›¸å…³å‡½æ•°
        async function loadKnowledgePoints() {
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/submissions?category=eq.knowledge&status=eq.approved&select=id,title,subject&order=created_at.desc&limit=50`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );
                
                if (response.ok) {
                    const knowledgeList = await response.json();
                    availableKnowledge = knowledgeList.map(item => ({
                        id: item.id,
                        title: item.title || 'æœªå‘½åçŸ¥è¯†ç‚¹',
                        subject: item.subject || 'general'
                    }));
                } else {
                    availableKnowledge = getMockKnowledge();
                }
            } catch (error) {
                console.log('åŠ è½½çŸ¥è¯†ç‚¹å¤±è´¥:', error);
                availableKnowledge = getMockKnowledge();
            }
            
            displayKnowledge(availableKnowledge);
        }

        function getMockKnowledge() {
            return [
                { id: 'mock-1', title: 'æ¯”å–»', subject: 'chinese' },
                { id: 'mock-2', title: 'å‹¾è‚¡å®šç†', subject: 'math' },
                { id: 'mock-3', title: 'ç‰›é¡¿ç¬¬äºŒå®šå¾‹', subject: 'physics' },
                { id: 'mock-4', title: 'å…ƒç´ å‘¨æœŸè¡¨', subject: 'chemistry' },
                { id: 'mock-5', title: 'æˆè¯­å…¸æ•…', subject: 'chinese' }
            ];
        }

        function displayKnowledge(knowledgeList) {
            const knowledgeSelection = document.getElementById('knowledgeSelection');
            
            if (knowledgeList.length === 0) {
                knowledgeSelection.innerHTML = '<div class="no-knowledge">æš‚æ— å¯ç”¨çŸ¥è¯†ç‚¹</div>';
                return;
            }
            
            let html = '';
            knowledgeList.forEach(item => {
                const subjectName = subjects.find(s => s.id === item.subject)?.name || item.subject;
                html += `
                    <button type="button" class="knowledge-btn" 
                            data-id="${item.id}" 
                            data-title="${item.title}"
                            data-subject="${item.subject}">
                        ${item.title} <small style="color: var(--text-muted);">(${subjectName})</small>
                    </button>
                `;
            });
            
            knowledgeSelection.innerHTML = html;
            
            knowledgeSelection.querySelectorAll('.knowledge-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.knowledge-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    document.getElementById('selectedKnowledgeId').value = this.dataset.id;
                    document.getElementById('selectedKnowledgeTitle').value = this.dataset.title;
                });
            });
        }

        function searchKnowledge() {
            const searchTerm = document.getElementById('knowledgeSearch').value.toLowerCase().trim();
            
            if (searchTerm.length === 0) {
                displayKnowledge(availableKnowledge);
                return;
            }
            
            const filtered = availableKnowledge.filter(item => 
                item.title.toLowerCase().includes(searchTerm) ||
                (item.subject && item.subject.toLowerCase().includes(searchTerm))
            );
            
            displayKnowledge(filtered);
        }

        function switchPage(page) {
            document.querySelectorAll('.page-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('submitPage').style.display = 'none';
            document.getElementById('historyPage').style.display = 'none';
            
            document.getElementById(page + 'Page').style.display = 'block';
            
            if (page === 'history') {
                loadSubmissionHistory();
            }
        }

        function switchType(type) {
            const knowledgeBtn = document.querySelector('.type-btn:nth-child(1)');
            const gameBtn = document.querySelector('.type-btn:nth-child(2)');
            const knowledgeForm = document.getElementById('knowledgeForm');
            const gameForm = document.getElementById('gameForm');
            
            if (type === 'knowledge') {
                knowledgeBtn.classList.add('active');
                gameBtn.classList.remove('active');
                knowledgeForm.style.display = 'block';
                gameForm.style.display = 'none';
            } else {
                gameBtn.classList.add('active');
                knowledgeBtn.classList.remove('active');
                knowledgeForm.style.display = 'none';
                gameForm.style.display = 'block';
            }
        }

        function showGameContent(gameType) {
            document.getElementById('matchGameContent').style.display = 'none';
            document.getElementById('trueFalseContent').style.display = 'none';
            document.getElementById('guessContent').style.display = 'none';
            
            switch(gameType) {
                case 'matching':
                    document.getElementById('matchGameContent').style.display = 'block';
                    break;
                case 'true_false':
                    document.getElementById('trueFalseContent').style.display = 'block';
                    break;
                case 'guess':
                    document.getElementById('guessContent').style.display = 'block';
                    break;
            }
        }

        function updateWordCount() {
            const textarea = document.getElementById('knowledgeContent');
            const wordCount = document.getElementById('knowledgeWordCount');
            const length = textarea.value.length;
            
            wordCount.textContent = `${length}/200 å­—`;
            
            if (length < 50) {
                wordCount.className = 'word-count warning';
            } else if (length > 200) {
                wordCount.className = 'word-count error';
            } else {
                wordCount.className = 'word-count';
            }
        }

        function validateKnowledgeContent() {
            const content = document.getElementById('knowledgeContent').value;
            const errorDiv = document.getElementById('knowledgeError');
            
            if (content.length > 0 && content.length < 50) {
                errorDiv.className = 'message error';
                errorDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> ç®€è¿°è‡³å°‘éœ€è¦50å­—';
                errorDiv.classList.remove('hidden');
            } else {
                errorDiv.classList.add('hidden');
            }
        }

        function showMessage(type, message, formId) {
            const messageDiv = document.getElementById(formId + 'Message');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <div>${message}</div>
            `;
            messageDiv.classList.remove('hidden');
            
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        async function submitKnowledge(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showMessage('error', 'è¯·å…ˆç™»å½•', 'knowledge');
                return;
            }
            
            const selectedSubject = document.querySelector('#subjectSelection .subject-btn.selected');
            const selectedTags = Array.from(document.querySelectorAll('#tagSelection .tag-btn.selected'))
                .map(btn => btn.dataset.id).join(',');
            
            const content = document.getElementById('knowledgeContent').value.trim();
            const title = document.getElementById('knowledgeTitle').value.trim();
            
            if (!selectedSubject) {
                showMessage('error', 'è¯·é€‰æ‹©ç§‘ç›®', 'knowledge');
                return;
            }
            
            if (!title) {
                showMessage('error', 'è¯·è¾“å…¥çŸ¥è¯†ç‚¹åç§°', 'knowledge');
                return;
            }
            
            if (!content) {
                showMessage('error', 'è¯·è¾“å…¥çŸ¥è¯†ç‚¹ç®€è¿°', 'knowledge');
                return;
            }
            
            if (content.length < 50) {
                showMessage('error', 'ç®€è¿°è‡³å°‘éœ€è¦50å­—', 'knowledge');
                return;
            }
            
            if (content.length > 200) {
                showMessage('error', 'ç®€è¿°ä¸èƒ½è¶…è¿‡200å­—', 'knowledge');
                return;
            }
            
            const formData = {
                title: title,
                content: content,
                user_id: currentUser.id,
                author_name: currentUser.username || currentUser.email?.split('@')[0] || 'åŒ¿åç”¨æˆ·',
                status: 'pending_review',
                category: 'knowledge',
                subject: selectedSubject.dataset.id,
                tags: selectedTags,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            const submitBtn = e.target.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/submissions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    showMessage('success', 'çŸ¥è¯†ç‚¹æŠ•ç¨¿æäº¤æˆåŠŸï¼ç­‰å¾…å®¡æ ¸ä¸­...', 'knowledge');
                    
                    e.target.reset();
                    document.querySelectorAll('#subjectSelection .selected, #tagSelection .selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    updateWordCount();
                    
                    setTimeout(() => {
                        loadUserStats();
                        loadKnowledgePoints();
                    }, 1000);
                    
                } else {
                    const errorText = await response.text();
                    throw new Error(`æŠ•ç¨¿å¤±è´¥: ${response.status} ${errorText}`);
                }
                
            } catch (error) {
                console.error('æäº¤å¤±è´¥:', error);
                showMessage('error', 'æŠ•ç¨¿å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'knowledge');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function submitGame(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showMessage('error', 'è¯·å…ˆç™»å½•', 'game');
                return;
            }
            
            const selectedGameType = document.querySelector('.game-type-btn.selected');
            if (!selectedGameType) {
                showMessage('error', 'è¯·é€‰æ‹©æ¸¸æˆç±»å‹', 'game');
                return;
            }
            
            const selectedKnowledge = document.querySelector('.knowledge-btn.selected');
            if (!selectedKnowledge) {
                showMessage('error', 'è¯·é€‰æ‹©å…³è”çŸ¥è¯†ç‚¹', 'game');
                return;
            }
            
            const selectedDifficulty = document.getElementById('gameDifficulty').value;
            if (!selectedDifficulty) {
                showMessage('error', 'è¯·é€‰æ‹©éš¾åº¦', 'game');
                return;
            }
            
            const gameType = selectedGameType.dataset.type;
            let gameData = {};
            let isValid = true;
            
            switch(gameType) {
                case 'matching':
                    const examples = document.getElementById('matchExamples').value.trim();
                    if (!examples) {
                        showMessage('error', 'è¯·è¾“å…¥ä¾‹å­', 'game');
                        isValid = false;
                    } else {
                        const examplesArray = examples.split('\n')
                            .map(line => line.trim())
                            .filter(line => line.length > 0);
                        
                        if (examplesArray.length < 2) {
                            showMessage('error', 'è¯·è¾“å…¥è‡³å°‘2ä¸ªä¾‹å­', 'game');
                            isValid = false;
                        } else {
                            gameData = {
                                topic: selectedKnowledge.dataset.title,
                                examples: examplesArray
                            };
                        }
                    }
                    break;
                    
                case 'true_false':
                    const question = document.getElementById('tfQuestion').value.trim();
                    const answer = document.getElementById('tfAnswer').value;
                    if (!question || !answer) {
                        showMessage('error', 'è¯·å¡«å†™é—®é¢˜å’Œé€‰æ‹©ç­”æ¡ˆ', 'game');
                        isValid = false;
                    } else {
                        gameData = { 
                            question: question, 
                            answer: answer === 'true' 
                        };
                    }
                    break;
                    
                case 'guess':
                    const description = document.getElementById('guessDescription').value.trim();
                    if (!description) {
                        showMessage('error', 'è¯·å¡«å†™æè¿°', 'game');
                        isValid = false;
                    } else {
                        gameData = { 
                            description: description,
                            answer: selectedKnowledge.dataset.title
                        };
                    }
                    break;
            }
            
            if (!isValid) return;
            
            const formData = {
                title: selectedKnowledge.dataset.title,
                content: JSON.stringify(gameData),
                user_id: currentUser.id,
                author_name: currentUser.username || currentUser.email?.split('@')[0] || 'åŒ¿åç”¨æˆ·',
                status: 'pending_review',
                category: 'game',
                game_type: gameType,
                difficulty: selectedDifficulty,
                subject: selectedKnowledge.dataset.subject,
                knowledge_id: selectedKnowledge.dataset.id,
                question_data: JSON.stringify(gameData),
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            const submitBtn = e.target.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...';
            submitBtn.disabled = true;
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/submissions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    showMessage('success', 'æ¸¸æˆæŠ•ç¨¿æäº¤æˆåŠŸï¼ç­‰å¾…å®¡æ ¸ä¸­...', 'game');
                    
                    e.target.reset();
                    document.querySelectorAll('.game-type-btn.selected, .difficulty-btn.selected, .tf-answer.selected, .knowledge-btn.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    document.getElementById('gameDifficulty').value = '';
                    document.getElementById('tfAnswer').value = '';
                    document.getElementById('selectedKnowledgeId').value = '';
                    document.getElementById('selectedKnowledgeTitle').value = '';
                    
                    document.querySelectorAll('[id$="Content"]').forEach(el => {
                        el.style.display = 'none';
                    });
                    
                    document.getElementById('knowledgeSearch').value = '';
                    displayKnowledge(availableKnowledge);
                    
                    setTimeout(() => {
                        loadUserStats();
                    }, 1000);
                    
                } else {
                    const errorText = await response.text();
                    throw new Error(`æ¸¸æˆæŠ•ç¨¿å¤±è´¥: ${response.status} ${errorText}`);
                }
                
            } catch (error) {
                console.error('æ¸¸æˆæäº¤å¤±è´¥:', error);
                showMessage('error', 'æ¸¸æˆæŠ•ç¨¿å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'game');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function loadSubmissionHistory() {
            if (!currentUser) return;
            
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '<div class="loading"><div class="loading-spinner"></div>åŠ è½½æŠ•ç¨¿å†å²...</div>';
            
            try {
                const response = await fetch(
                    `${SUPABASE_URL}/rest/v1/submissions?user_id=eq.${currentUser.id}&select=*&order=created_at.desc`,
                    {
                        headers: {
                            'apikey': SUPABASE_KEY,
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        }
                    }
                );
                
                if (response.ok) {
                    const submissions = await response.json();
                    userSubmissions = submissions || [];
                    displayHistory(userSubmissions);
                } else {
                    historyList.innerHTML = '<div class="no-history">åŠ è½½æŠ•ç¨¿å†å²å¤±è´¥</div>';
                }
            } catch (error) {
                console.log('åŠ è½½æŠ•ç¨¿å†å²å¤±è´¥:', error);
                historyList.innerHTML = '<div class="no-history">åŠ è½½æŠ•ç¨¿å†å²å¤±è´¥</div>';
            }
        }

        function displayHistory(submissions) {
            const historyList = document.getElementById('historyList');
            
            if (!submissions || submissions.length === 0) {
                historyList.innerHTML = '<div class="no-history">æš‚æ— æŠ•ç¨¿è®°å½•</div>';
                return;
            }
            
            let filteredSubmissions = submissions;
            if (currentHistoryFilter === 'knowledge') {
                filteredSubmissions = submissions.filter(s => s.category === 'knowledge');
            } else if (currentHistoryFilter === 'game') {
                filteredSubmissions = submissions.filter(s => s.category === 'game');
            } else if (currentHistoryFilter === 'pending_review') {
                filteredSubmissions = submissions.filter(s => s.status === 'pending_review');
            } else if (currentHistoryFilter === 'approved') {
                filteredSubmissions = submissions.filter(s => s.status === 'approved');
            } else if (currentHistoryFilter === 'rejected') {
                filteredSubmissions = submissions.filter(s => s.status === 'rejected');
            }
            
            if (filteredSubmissions.length === 0) {
                historyList.innerHTML = '<div class="no-history">æš‚æ— ç›¸å…³æŠ•ç¨¿è®°å½•</div>';
                return;
            }
            
            let html = '';
            filteredSubmissions.forEach(submission => {
                let statusClass = '';
                let statusText = '';
                switch(submission.status) {
                    case 'pending_review':
                        statusClass = 'status-pending';
                        statusText = 'ç­‰å¾…å®¡æ ¸';
                        break;
                    case 'approved':
                        statusClass = 'status-approved';
                        statusText = 'å·²é€šè¿‡';
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        statusText = 'å·²æ‹’ç»';
                        break;
                    default:
                        statusClass = 'status-pending';
                        statusText = submission.status;
                }
                
                const subjectName = subjects.find(s => s.id === submission.subject)?.name || submission.subject || 'æœªåˆ†ç±»';
                
                let gameInfo = '';
                if (submission.category === 'game') {
                    const gameTypeText = submission.game_type === 'matching' ? 'è¿è¿çœ‹' :
                                       submission.game_type === 'true_false' ? 'å¯¹é”™åˆ¤æ–­' :
                                       submission.game_type === 'guess' ? 'çŒœçŸ¥è¯†ç‚¹' : '';
                    
                    const difficultyText = submission.difficulty === 'easy' ? 'ç®€å•' :
                                         submission.difficulty === 'medium' ? 'ä¸­ç­‰' :
                                         submission.difficulty === 'hard' ? 'å›°éš¾' : '';
                    
                    gameInfo = `
                        <span><i class="fas fa-gamepad"></i> ${gameTypeText}</span>
                        <span><i class="fas fa-chart-line"></i> ${difficultyText}</span>
                    `;
                }
                
                const tags = submission.tags ? submission.tags.split(',') : [];
                const tagNames = tags.map(tagId => {
                    const tag = tags.find(t => t.id === tagId);
                    return tag ? tag.name : tagId;
                });
                
                const tagsHtml = tagNames.map(tagName => 
                    `<span class="history-tag">${tagName}</span>`
                ).join('');
                
                let contentPreview = '';
                if (submission.category === 'knowledge') {
                    contentPreview = submission.content || '';
                    if (contentPreview.length > 100) {
                        contentPreview = contentPreview.substring(0, 100) + '...';
                    }
                } else if (submission.category === 'game') {
                    try {
                        const gameData = JSON.parse(submission.content || '{}');
                        if (submission.game_type === 'matching') {
                            const examples = gameData.examples || [];
                            contentPreview = `è¿è¿çœ‹ï¼š${submission.title}ï¼Œ${examples.length}ä¸ªä¾‹å­`;
                        } else if (submission.game_type === 'true_false') {
                            contentPreview = gameData.question || 'åˆ¤æ–­é¢˜';
                            if (contentPreview.length > 80) {
                                contentPreview = contentPreview.substring(0, 80) + '...';
                            }
                        } else if (submission.game_type === 'guess') {
                            contentPreview = gameData.description || 'æè¿°é¢˜';
                            if (contentPreview.length > 80) {
                                contentPreview = contentPreview.substring(0, 80) + '...';
                            }
                        }
                    } catch (e) {
                        contentPreview = 'æ¸¸æˆé¢˜ç›®';
                    }
                }
                
                html += `
                    <div class="history-item">
                        <div class="history-header">
                            <div class="history-title">${submission.title || 'æœªå‘½å'}</div>
                            <div class="history-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="history-meta">
                            <span><i class="fas fa-book"></i> ${subjectName}</span>
                            <span><i class="fas fa-tag"></i> ${submission.category === 'knowledge' ? 'çŸ¥è¯†ç‚¹' : 'å°æ¸¸æˆ'}</span>
                            ${gameInfo}
                        </div>
                        <div class="history-content">${contentPreview}</div>
                        <div class="history-footer">
                            <div class="history-tags">${tagsHtml}</div>
                            <div>${new Date(submission.created_at).toLocaleDateString('zh-HK')}</div>
                        </div>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;
        }

        function filterHistory(filter) {
            currentHistoryFilter = filter;
            
            document.querySelectorAll('.page-tabs + .submission-form .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayHistory(userSubmissions);
        }

        function openGames() {
            window.open('notes.html', '_blank');
        }

        function openNotes() {
            window.open('gaming.html', '_blank');
        }
    </script>
</body>
</html>

