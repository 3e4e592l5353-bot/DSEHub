<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•ç¨¿ä¸­å¿ƒ - DSEHub</title>
    <style>
        :root {
            --primary-start: #667eea;
            --primary-end: #764ba2;
            --secondary-start: #667eea;
            --secondary-end: #764ba2;
            --accent-color: #5a67d8;
            --accent-light: rgba(90, 103, 216, 0.1);
            --accent-dark: #4c51bf;
            
            --card-bg: rgba(255, 255, 255, 0.98);
            --card-shadow: rgba(102, 126, 234, 0.08);
            --border-color: rgba(102, 126, 234, 0.15);
            --hover-color: rgba(102, 126, 234, 0.06);
            --active-color: rgba(102, 126, 234, 0.15);
            --text-color: #2d3748;
            --text-secondary: #718096;
            --text-muted: #a0aec0;
            
            --btn-bg: linear-gradient(135deg, #667eea, #764ba2);
            --btn-hover: linear-gradient(135deg, #5a67d8, #6b46c1);
            --btn-active: linear-gradient(135deg, #4c51bf, #553c9a);
            
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --error-color: #f56565;
            --info-color: #4299e1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            background: var(--btn-bg);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 24px;
            border: none;
            border-radius: 12px;
            background: var(--btn-bg);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: var(--btn-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px var(--card-shadow);
        }

        /* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
        .user-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }

        .user-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .user-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            flex: 1;
            min-width: 150px;
            background: var(--accent-light);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid var(--accent-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
            line-height: 1.2;
        }

        /* æŠ•ç¨¿ç±»å‹åˆ‡æ¢ */
        .submission-type {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 5px 20px var(--card-shadow);
            flex-wrap: wrap;
        }

        .type-btn {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border: none;
            background: transparent;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-align: center;
        }

        .type-btn.active {
            background: var(--btn-bg);
            color: white;
            box-shadow: 0 5px 15px var(--card-shadow);
        }

        /* æŠ•ç¨¿è¡¨å•æ ·å¼ */
        .submission-form {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 50px var(--card-shadow);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            margin-bottom: 15px;
            color: var(--accent-color);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
            line-height: 1.4;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
            line-height: 1.4;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            line-height: 1.5;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        /* ç§‘ç›®é€‰æ‹©ç½‘æ ¼ */
        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .subject-option {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            line-height: 1.4;
            word-break: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .subject-option:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
            transform: translateY(-2px);
        }

        .subject-option.selected {
            border-color: var(--accent-color);
            background: var(--btn-bg);
            color: white;
            box-shadow: 0 5px 15px var(--card-shadow);
        }

        .subject-option.core {
            border-left: 4px solid var(--success-color);
        }

        .subject-option.elective {
            border-left: 4px solid var(--info-color);
        }

        /* æ ‡ç­¾é€‰æ‹© */
        .tag-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .tag-btn {
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            line-height: 1.4;
            white-space: nowrap;
        }

        .tag-btn:hover {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .tag-btn.selected {
            border-color: var(--accent-color);
            background: var(--btn-bg);
            color: white;
        }

        /* æ¸¸æˆç±»å‹é€‰æ‹© */
        .game-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 10px;
        }

        .game-type-card {
            padding: 20px;
            border: 2px solid var(--border-color);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            text-align: center;
        }

        .game-type-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--card-shadow);
        }

        .game-type-card.selected {
            border-color: var(--accent-color);
            background: var(--accent-light);
        }

        .game-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: var(--btn-bg);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
        }

        /* æäº¤æŒ‰é’® */
        .submit-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            background: var(--btn-bg);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .submit-btn:hover {
            background: var(--btn-hover);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--card-shadow);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        /* ç¤ºä¾‹è¯´æ˜ */
        .example-hint {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
            padding: 10px;
            background: var(--accent-light);
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
            line-height: 1.5;
        }

        /* çŸ¥è¯†ç‚¹é€‰æ‹©å™¨ */
        .knowledge-selector {
            position: relative;
        }

        .knowledge-search {
            width: 100%;
            padding: 12px 16px;
            padding-right: 40px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .knowledge-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            margin-top: 5px;
            background: white;
            display: none;
            position: absolute;
            width: 100%;
            z-index: 1000;
        }

        .knowledge-list.active {
            display: block;
        }

        .knowledge-item {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.3s ease;
            line-height: 1.4;
        }

        .knowledge-item:hover {
            background: var(--accent-light);
        }

        .knowledge-item:last-child {
            border-bottom: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .subject-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .game-type-grid {
                grid-template-columns: 1fr;
            }
            
            .type-btn {
                min-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .subject-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-item {
                min-width: 100%;
            }
            
            .user-stats {
                flex-direction: column;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* æˆåŠŸ/é”™è¯¯æ¶ˆæ¯ */
        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message.success {
            background-color: rgba(72, 187, 120, 0.1);
            border-left: 4px solid var(--success-color);
            color: #2f855a;
        }

        .message.error {
            background-color: rgba(245, 101, 101, 0.1);
            border-left: 4px solid var(--error-color);
            color: #c53030;
        }

        .message.warning {
            background-color: rgba(237, 137, 54, 0.1);
            border-left: 4px solid var(--warning-color);
            color: #c05621;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <div class="header">
            <h1>ğŸ“š DSEHub æŠ•ç¨¿ä¸­å¿ƒ</h1>
            <div class="nav-buttons">
                <a href="https://3e4e592l5353-bot.github.io/DSEHub/" class="nav-btn">
                    <i class="fas fa-home"></i> è¿”å›ä¸»ç«™
                </a>
                <button class="nav-btn" onclick="openGames()">
                    <i class="fas fa-gamepad"></i> å°æ¸¸æˆç½‘ç«™
                </button>
                <button class="nav-btn" onclick="openNotes()">
                    <i class="fas fa-sticky-note"></i> ç¬”è®°ä¸“åŒº
                </button>
            </div>
        </div>

        <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
        <div class="user-card">
            <div class="user-info">
                <div>
                    <h2 id="username">åŠ è½½ä¸­...</h2>
                    <p id="userEmail">æ­£åœ¨è·å–ç”¨æˆ·ä¿¡æ¯...</p>
                </div>
                <div class="user-stats">
                    <div class="stat-item">
                        <div class="stat-label">å­¦ä¹ ç§¯åˆ†</div>
                        <div class="stat-value" id="userScore">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æ¸¸æˆæ¬¡æ•°</div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">æœ€é«˜åˆ†</div>
                        <div class="stat-value" id="highScore">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¯¹æˆ˜èƒœåˆ©</div>
                        <div class="stat-value" id="duelWins">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æŠ•ç¨¿ç±»å‹åˆ‡æ¢ -->
        <div class="submission-type">
            <button class="type-btn active" onclick="switchType('knowledge')">
                <i class="fas fa-graduation-cap"></i> çŸ¥è¯†ç‚¹æŠ•ç¨¿
            </button>
            <button class="type-btn" onclick="switchType('game')">
                <i class="fas fa-gamepad"></i> å°æ¸¸æˆæŠ•ç¨¿
            </button>
        </div>

        <!-- çŸ¥è¯†ç‚¹æŠ•ç¨¿è¡¨å• -->
        <div id="knowledgeForm" class="submission-form">
            <div id="knowledgeMessage" class="message hidden"></div>
            <form id="knowledgeSubmissionForm">
                <div class="form-section">
                    <h3><i class="fas fa-book"></i> åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="form-group">
                        <label class="form-label">æ ‡é¢˜ *</label>
                        <input type="text" class="form-control" id="knowledgeTitle" placeholder="è¯·è¾“å…¥çŸ¥è¯†ç‚¹æ ‡é¢˜" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">å†…å®¹æè¿° *</label>
                        <textarea class="form-control textarea" id="knowledgeContent" placeholder="è¯·è¯¦ç»†æè¿°çŸ¥è¯†ç‚¹å†…å®¹..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ç¤ºä¾‹ (å¯é€‰)</label>
                        <textarea class="form-control textarea" id="knowledgeExample" placeholder="æä¾›ä¸€äº›ç¤ºä¾‹ï¼Œå¸®åŠ©ç†è§£..."></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-tags"></i> ç§‘ç›®åˆ†ç±»</h3>
                    <div class="subject-grid" id="subjectSelection">
                        <!-- ç§‘ç›®é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-tag"></i> çŸ¥è¯†ç‚¹æ ‡ç­¾</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">è¯·é€‰æ‹©é€‚ç”¨çš„æ ‡ç­¾ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</p>
                    
                    <div class="form-group">
                        <label class="form-label">ç±»åˆ«æ ‡ç­¾</label>
                        <div class="tag-options" id="categoryTags">
                            <!-- ç±»åˆ«æ ‡ç­¾é€šè¿‡JSç”Ÿæˆ -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">éš¾åº¦çº§åˆ« *</label>
                        <div class="tag-options" id="difficultyTags">
                            <!-- éš¾åº¦æ ‡ç­¾é€šè¿‡JSç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i> æäº¤çŸ¥è¯†ç‚¹æŠ•ç¨¿
                </button>
            </form>
        </div>

        <!-- å°æ¸¸æˆæŠ•ç¨¿è¡¨å• -->
        <div id="gameForm" class="submission-form" style="display: none;">
            <div id="gameMessage" class="message hidden"></div>
            <form id="gameSubmissionForm">
                <div class="form-section">
                    <h3><i class="fas fa-gamepad"></i> æ¸¸æˆåŸºæœ¬ä¿¡æ¯</h3>
                    
                    <div class="form-group">
                        <label class="form-label">æ¸¸æˆæ ‡é¢˜ *</label>
                        <input type="text" class="form-control" id="gameTitle" placeholder="è¯·è¾“å…¥æ¸¸æˆæ ‡é¢˜" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å…³è”çŸ¥è¯†ç‚¹</label>
                        <div class="knowledge-selector">
                            <input type="text" class="form-control knowledge-search" id="knowledgeSearch" 
                                   placeholder="æœç´¢æˆ–è¾“å…¥çŸ¥è¯†ç‚¹æ ‡é¢˜...">
                            <i class="fas fa-search search-icon"></i>
                            <div class="knowledge-list" id="knowledgeList">
                                <!-- çŸ¥è¯†ç‚¹åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                            </div>
                        </div>
                        <div class="example-hint">
                            æç¤ºï¼šå¯ä»¥é€‰æ‹©ç°æœ‰çŸ¥è¯†ç‚¹æˆ–è¾“å…¥æ–°çš„çŸ¥è¯†ç‚¹æ ‡é¢˜
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">éš¾åº¦çº§åˆ« *</label>
                        <div class="tag-options">
                            <button type="button" class="tag-btn difficulty-btn" data-value="easy">ç®€å•</button>
                            <button type="button" class="tag-btn difficulty-btn" data-value="medium">ä¸­ç­‰</button>
                            <button type="button" class="tag-btn difficulty-btn" data-value="hard">å›°éš¾</button>
                        </div>
                        <input type="hidden" id="gameDifficulty" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ‰€å±ç§‘ç›®</label>
                        <div class="tag-options" id="gameSubjectTags">
                            <!-- æ¸¸æˆç§‘ç›®æ ‡ç­¾å°†é€šè¿‡JSç”Ÿæˆ -->
                        </div>
                        <input type="hidden" id="gameSubject">
                    </div>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-chess"></i> é€‰æ‹©æ¸¸æˆç±»å‹</h3>
                    <div class="game-type-grid" id="gameTypeSelection">
                        <!-- æ¸¸æˆç±»å‹å¡ç‰‡é€šè¿‡JSç”Ÿæˆ -->
                    </div>
                </div>

                <!-- è¿è¿çœ‹æ¸¸æˆå†…å®¹ -->
                <div id="matchGameContent" class="form-section" style="display: none;">
                    <h3><i class="fas fa-link"></i> è¿è¿çœ‹æ¸¸æˆè®¾ç½®</h3>
                    
                    <div class="form-group">
                        <label class="form-label">ä¸»é¢˜/è¯é¢˜ *</label>
                        <input type="text" class="form-control" id="matchTopic" placeholder="ä¾‹å¦‚ï¼šæ•°å­¦å…¬å¼é…å¯¹" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">é…å¯¹é¡¹ç›® *</label>
                        <textarea class="form-control textarea" id="matchExamples" 
                                  placeholder="è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å…¥é…å¯¹é¡¹ç›®ï¼ˆæ¯è¡Œä¸€å¯¹ï¼Œç”¨ // åˆ†éš”ï¼‰ï¼š&#10;é¡¹ç›®A // å¯¹åº”çš„é¡¹ç›®B&#10;ä¾‹å¦‚ï¼š&#10;å‹¾è‚¡å®šç† // aÂ²+bÂ²=cÂ²&#10;äºŒæ¬¡å…¬å¼ // x = [-bÂ±âˆš(bÂ²-4ac)]/2a" required></textarea>
                        <div class="example-hint">
                            æ ¼å¼è¯´æ˜ï¼šå·¦è¾¹é¡¹ç›® // å³è¾¹å¯¹åº”é¡¹ç›®ï¼Œæ¯è¡Œä¸€ç»„é…å¯¹
                        </div>
                    </div>
                </div>

                <!-- å¯¹é”™åˆ¤æ–­é¢˜å†…å®¹ -->
                <div id="trueFalseContent" class="form-section" style="display: none;">
                    <h3><i class="fas fa-check-circle"></i> å¯¹é”™åˆ¤æ–­è®¾ç½®</h3>
                    
                    <div class="form-group">
                        <label class="form-label">é—®é¢˜é™ˆè¿° *</label>
                        <textarea class="form-control textarea" id="tfQuestion" 
                                  placeholder="è¯·è¾“å…¥éœ€è¦åˆ¤æ–­æ­£è¯¯çš„é™ˆè¿°..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ­£ç¡®ç­”æ¡ˆ *</label>
                        <div class="tag-options">
                            <button type="button" class="tag-btn tf-answer" data-value="true">
                                <i class="fas fa-check"></i> æ­£ç¡®
                            </button>
                            <button type="button" class="tag-btn tf-answer" data-value="false">
                                <i class="fas fa-times"></i> é”™è¯¯
                            </button>
                        </div>
                        <input type="hidden" id="tfAnswer" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">è§£é‡Šè¯´æ˜ (å¯é€‰)</label>
                        <textarea class="form-control textarea" id="tfExplanation" 
                                  placeholder="ä¸ºä»€ä¹ˆè¿™ä¸ªé™ˆè¿°æ˜¯å¯¹/é”™çš„..."></textarea>
                    </div>
                </div>

                <!-- çŒœçŸ¥è¯†ç‚¹æ¸¸æˆå†…å®¹ -->
                <div id="guessContent" class="form-section" style="display: none;">
                    <h3><i class="fas fa-lightbulb"></i> çŒœçŸ¥è¯†ç‚¹è®¾ç½®</h3>
                    
                    <div class="form-group">
                        <label class="form-label">æè¿°/æç¤º *</label>
                        <textarea class="form-control textarea" id="guessDescription" 
                                  placeholder="è¯·æè¿°è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œä½†ä¸ç›´æ¥è¯´å‡ºåç§°..." required></textarea>
                        <div class="example-hint">
                            ä¾‹å¦‚ï¼š"è¿™ä¸ªå…¬å¼ç”¨äºè®¡ç®—ç›´è§’ä¸‰è§’å½¢æ–œè¾¹çš„é•¿åº¦"
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æ­£ç¡®ç­”æ¡ˆ *</label>
                        <input type="text" class="form-control" id="guessAnswer" 
                               placeholder="è¯·è¾“å…¥è¦çŒœçš„çŸ¥è¯†ç‚¹åç§°" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">é¢å¤–æç¤º (å¯é€‰)</label>
                        <textarea class="form-control textarea" id="guessHints" 
                                  placeholder="å¯ä»¥æä¾›å¤šä¸ªæç¤ºï¼Œæ¯è¡Œä¸€ä¸ª..."></textarea>
                    </div>
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i> æäº¤å°æ¸¸æˆæŠ•ç¨¿
                </button>
            </form>
        </div>
    </div>

    <script>
        // Supabase é…ç½®
        const SUPABASE_URL = 'https://alsalyskulozwakhmzoa.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_SYzZpjbWZgKUzzGQxR-jGg_B1em-5Tr';

        // å®Œæ•´çš„DSEç§‘ç›®åˆ—è¡¨
        const dseSubjects = [
            // æ ¸å¿ƒç§‘ç›®
            { id: 'chinese', name: 'ä¸­å›½è¯­æ–‡', type: 'core' },
            { id: 'english', name: 'è‹±å›½è¯­æ–‡', type: 'core' },
            { id: 'math', name: 'æ•°å­¦', type: 'core' },
            { id: 'ls', name: 'å…¬æ°‘ä¸ç¤¾ä¼šå‘å±•', type: 'core' },
            
            // æ•°å­¦å»¶ä¼¸
            { id: 'm1', name: 'æ•°å­¦å»¶ä¼¸å•å…ƒä¸€', type: 'elective' },
            { id: 'm2', name: 'æ•°å­¦å»¶ä¼¸å•å…ƒäºŒ', type: 'elective' },
            
            // ç†ç§‘
            { id: 'biology', name: 'ç”Ÿç‰©', type: 'elective' },
            { id: 'chemistry', name: 'åŒ–å­¦', type: 'elective' },
            { id: 'physics', name: 'ç‰©ç†', type: 'elective' },
            { id: 'combined_science', name: 'ç»¼åˆç§‘å­¦', type: 'elective' },
            
            // æ–‡ç§‘
            { id: 'chinese_history', name: 'ä¸­å›½å†å²', type: 'elective' },
            { id: 'history', name: 'å†å²', type: 'elective' },
            { id: 'geography', name: 'åœ°ç†', type: 'elective' },
            { id: 'economics', name: 'ç»æµ', type: 'elective' },
            
            // è¯­æ–‡å»¶ä¼¸
            { id: 'chinese_literature', name: 'ä¸­å›½æ–‡å­¦', type: 'elective' },
            { id: 'english_literature', name: 'è‹±å›½æ–‡å­¦', type: 'elective' },
            
            // å•†ä¸š
            { id: 'bafs', name: 'ä¼ä¸šã€ä¼šè®¡ä¸è´¢åŠ¡æ¦‚è®º', type: 'elective' },
            { id: 'ict', name: 'èµ„è®¯åŠé€šè®¯æŠ€æœ¯', type: 'elective' },
            
            // å…¶ä»–é€‰ä¿®
            { id: 'ers', name: 'ä¼¦ç†ä¸å®—æ•™', type: 'elective' },
            { id: 'th', name: 'æ—…æ¸¸ä¸æ¬¾å¾…', type: 'elective' },
            { id: 'da', name: 'è®¾è®¡ä¸åº”ç”¨', type: 'elective' },
            { id: 'health', name: 'ç§‘æŠ€ä¸å¥åº·', type: 'elective' },
            { id: 'management', name: 'ç®¡ç†ä¸ç¤¾ä¼šç§‘å­¦', type: 'elective' },
            { id: 'technology_life', name: 'ç§‘æŠ€ä¸ç”Ÿæ´»', type: 'elective' },
            { id: 'music', name: 'éŸ³ä¹', type: 'elective' },
            { id: 'visual_arts', name: 'è§†è§‰è‰ºæœ¯', type: 'elective' },
            { id: 'pe', name: 'ä½“è‚²', type: 'elective' },
            
            // æ–°å¢ç§‘ç›®
            { id: 'applied_learning', name: 'åº”ç”¨å­¦ä¹ ', type: 'elective' },
            { id: 'other_languages', name: 'å…¶ä»–è¯­è¨€', type: 'elective' }
        ];

        // çŸ¥è¯†ç‚¹æ ‡ç­¾
        const categoryTags = [
            { id: 'formula', name: 'å…¬å¼' },
            { id: 'grammar', name: 'è¯­æ³•' },
            { id: 'quote', name: 'åè¨€é‡‘å¥' },
            { id: 'idiom', name: 'æˆè¯­æœ¯è¯­' },
            { id: 'concept', name: 'æ¦‚å¿µ' },
            { id: 'theorem', name: 'å®šç†' },
            { id: 'law', name: 'å®šå¾‹' },
            { id: 'method', name: 'æ–¹æ³•' },
            { id: 'skill', name: 'æŠ€å·§' },
            { id: 'case_study', name: 'ä¸ªæ¡ˆç ”ç©¶' }
        ];

        // æ¸¸æˆç±»å‹
        const gameTypes = [
            {
                id: 'matching',
                name: 'è¿è¿çœ‹',
                icon: 'fas fa-link',
                description: 'é…å¯¹ç›¸å…³çš„çŸ¥è¯†ç‚¹æˆ–æ¦‚å¿µ'
            },
            {
                id: 'true_false',
                name: 'å¯¹é”™åˆ¤æ–­',
                icon: 'fas fa-check-circle',
                description: 'åˆ¤æ–­é™ˆè¿°çš„æ­£ç¡®æ€§'
            },
            {
                id: 'guess',
                name: 'çŒœçŸ¥è¯†ç‚¹',
                icon: 'fas fa-lightbulb',
                description: 'æ ¹æ®æè¿°çŒœå‡ºçŸ¥è¯†ç‚¹'
            }
        ];

        // ç”¨æˆ·æ•°æ®
        let currentUser = null;
        let availableKnowledge = [];

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            loadUserData();
            setupEventListeners();
            loadKnowledgeCategories();
        });

        function initializePage() {
            // åˆå§‹åŒ–ç§‘ç›®é€‰æ‹© - çŸ¥è¯†ç‚¹æŠ•ç¨¿
            const subjectGrid = document.getElementById('subjectSelection');
            dseSubjects.forEach(subject => {
                const subjectEl = document.createElement('div');
                subjectEl.className = `subject-option ${subject.type}`;
                subjectEl.dataset.id = subject.id;
                subjectEl.dataset.type = subject.type;
                subjectEl.textContent = subject.name;
                subjectEl.onclick = () => toggleSelection(subjectEl);
                subjectGrid.appendChild(subjectEl);
            });

            // åˆå§‹åŒ–ç§‘ç›®é€‰æ‹© - æ¸¸æˆæŠ•ç¨¿
            const gameSubjectTags = document.getElementById('gameSubjectTags');
            // åªæ˜¾ç¤ºéƒ¨åˆ†å¸¸ç”¨ç§‘ç›®ä¾›æ¸¸æˆæŠ•ç¨¿é€‰æ‹©
            const gameSubjects = dseSubjects.filter(subject => 
                ['chinese', 'english', 'math', 'biology', 'chemistry', 'physics', 'history', 'geography', 'economics'].includes(subject.id)
            );
            gameSubjects.forEach(subject => {
                const tagBtn = document.createElement('button');
                tagBtn.type = 'button';
                tagBtn.className = 'tag-btn';
                tagBtn.dataset.id = subject.id;
                tagBtn.textContent = subject.name;
                tagBtn.onclick = () => {
                    document.querySelectorAll('#gameSubjectTags .tag-btn').forEach(btn => btn.classList.remove('selected'));
                    tagBtn.classList.add('selected');
                    document.getElementById('gameSubject').value = subject.id;
                };
                gameSubjectTags.appendChild(tagBtn);
            });

            // åˆå§‹åŒ–ç±»åˆ«æ ‡ç­¾
            const categoryTagsEl = document.getElementById('categoryTags');
            categoryTags.forEach(tag => {
                const tagBtn = document.createElement('button');
                tagBtn.type = 'button';
                tagBtn.className = 'tag-btn';
                tagBtn.dataset.id = tag.id;
                tagBtn.textContent = tag.name;
                tagBtn.onclick = () => toggleSelection(tagBtn);
                categoryTagsEl.appendChild(tagBtn);
            });

            // åˆå§‹åŒ–éš¾åº¦æ ‡ç­¾ - çŸ¥è¯†ç‚¹æŠ•ç¨¿
            const difficultyTagsEl = document.getElementById('difficultyTags');
            ['åŸºç¡€', 'è¿›é˜¶', 'ä¸“å®¶'].forEach(diff => {
                const tagBtn = document.createElement('button');
                tagBtn.type = 'button';
                tagBtn.className = 'tag-btn';
                tagBtn.textContent = diff;
                tagBtn.onclick = () => {
                    document.querySelectorAll('#difficultyTags .tag-btn').forEach(btn => btn.classList.remove('selected'));
                    tagBtn.classList.add('selected');
                };
                difficultyTagsEl.appendChild(tagBtn);
            });

            // åˆå§‹åŒ–æ¸¸æˆç±»å‹é€‰æ‹©
            const gameTypeGrid = document.getElementById('gameTypeSelection');
            gameTypes.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-type-card';
                gameCard.dataset.type = game.id;
                gameCard.innerHTML = `
                    <div class="game-icon">
                        <i class="${game.icon}"></i>
                    </div>
                    <h4>${game.name}</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">${game.description}</p>
                `;
                gameCard.onclick = () => selectGameType(gameCard);
                gameTypeGrid.appendChild(gameCard);
            });
        }

        async function loadKnowledgeCategories() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/knowledge_categories?select=*&order=subject.asc`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const categories = await response.json();
                    availableKnowledge = categories;
                    console.log('åŠ è½½çŸ¥è¯†ç‚¹åˆ†ç±»æˆåŠŸ:', categories);
                } else {
                    console.warn('æ— æ³•ä»SupabaseåŠ è½½çŸ¥è¯†ç‚¹åˆ†ç±»ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');
                    // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    availableKnowledge = [
                        { subject: 'æ•°å­¦', title: 'å‹¾è‚¡å®šç†' },
                        { subject: 'æ•°å­¦', title: 'äºŒæ¬¡å…¬å¼' },
                        { subject: 'ç‰©ç†', title: 'ç‰›é¡¿ç¬¬äºŒå®šå¾‹' },
                        { subject: 'åŒ–å­¦', title: 'å…ƒç´ å‘¨æœŸè¡¨' },
                        { subject: 'ä¸­å›½è¯­æ–‡', title: 'æˆè¯­å…¸æ•…' },
                        { subject: 'è‹±å›½è¯­æ–‡', title: 'åŸºç¡€è¯­æ³•' }
                    ];
                }
            } catch (error) {
                console.error('åŠ è½½çŸ¥è¯†ç‚¹åˆ†ç±»å¤±è´¥:', error);
                // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                availableKnowledge = [
                    { subject: 'æ•°å­¦', title: 'å‹¾è‚¡å®šç†' },
                    { subject: 'æ•°å­¦', title: 'äºŒæ¬¡å…¬å¼' },
                    { subject: 'ç‰©ç†', title: 'ç‰›é¡¿ç¬¬äºŒå®šå¾‹' },
                    { subject: 'åŒ–å­¦', title: 'å…ƒç´ å‘¨æœŸè¡¨' },
                    { subject: 'ä¸­å›½è¯­æ–‡', title: 'æˆè¯­å…¸æ•…' },
                    { subject: 'è‹±å›½è¯­æ–‡', title: 'åŸºç¡€è¯­æ³•' }
                ];
            }
        }

        function loadUserData() {
            // å°è¯•ä»å¤šä¸ªåœ°æ–¹è·å–ç”¨æˆ·ä¿¡æ¯
            let userData = null;
            
            // 1. ä»localStorageè·å–
            try {
                const storedUser = localStorage.getItem('dsehub_user');
                if (storedUser) {
                    userData = JSON.parse(storedUser);
                }
            } catch (e) {
                console.log('æ— æ³•ä»localStorageè¯»å–ç”¨æˆ·æ•°æ®');
            }
            
            // 2. ä»URLå‚æ•°è·å–ï¼ˆå¦‚æœä»ä¸»ç«™è·³è½¬è¿‡æ¥ï¼‰
            if (!userData) {
                const urlParams = new URLSearchParams(window.location.search);
                const userParam = urlParams.get('user');
                if (userParam) {
                    try {
                        userData = JSON.parse(decodeURIComponent(userParam));
                    } catch (e) {
                        console.log('URLå‚æ•°ä¸­çš„ç”¨æˆ·æ•°æ®æ ¼å¼é”™è¯¯');
                    }
                }
            }
            
            // 3. ä»sessionStorageè·å–
            if (!userData) {
                try {
                    const sessionUser = sessionStorage.getItem('dsehub_user');
                    if (sessionUser) {
                        userData = JSON.parse(sessionUser);
                    }
                } catch (e) {
                    console.log('æ— æ³•ä»sessionStorageè¯»å–ç”¨æˆ·æ•°æ®');
                }
            }
            
            if (userData && userData.id) {
                currentUser = userData;
                updateUserDisplay(userData);
                fetchUserStats(userData.id);
            } else {
                // æ˜¾ç¤ºç™»å½•æç¤º
                document.getElementById('username').textContent = 'æœªç™»å½•';
                document.getElementById('userEmail').textContent = 'è¯·å…ˆç™»å½•ä¸»ç«™';
                
                // åˆ›å»ºç™»å½•æç¤º
                const loginMessage = document.createElement('div');
                loginMessage.className = 'message warning';
                loginMessage.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>éœ€è¦ç™»å½•</strong>
                        <p>è¯·å…ˆç™»å½•ä¸»ç«™æ‰èƒ½ä½¿ç”¨æŠ•ç¨¿åŠŸèƒ½ã€‚</p>
                        <a href="https://3e4e592l5353-bot.github.io/DSEHub/" class="nav-btn" style="padding: 5px 15px; font-size: 0.9rem; margin-top: 5px;">
                            <i class="fas fa-sign-in-alt"></i> å‰å¾€ç™»å½•
                        </a>
                    </div>
                `;
                document.querySelector('.user-card').appendChild(loginMessage);
                
                // ç¦ç”¨è¡¨å•
                document.querySelectorAll('form').forEach(form => {
                    form.querySelectorAll('input, textarea, button, select').forEach(element => {
                        element.disabled = true;
                    });
                });
            }
        }

        async function fetchUserStats(userId) {
            try {
                // å°è¯•ä»Supabaseè·å–ç”¨æˆ·æ•°æ®
                const response = await fetch(`${SUPABASE_URL}/rest/v1/profiles?select=*&id=eq.${userId}`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (response.ok) {
                    const profiles = await response.json();
                    if (profiles && profiles.length > 0) {
                        const profile = profiles[0];
                        updateStatsDisplay({
                            score: profile.score || 0,
                            games_played: profile.games_played || 0,
                            high_score: profile.high_score || 0,
                            duel_wins: profile.duel_wins || 0
                        });
                        return;
                    }
                }
            } catch (error) {
                console.log('æ— æ³•ä»Supabaseè·å–ç”¨æˆ·æ•°æ®:', error);
            }
            
            // å¦‚æœæ— æ³•ä»Supabaseè·å–ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
            updateStatsDisplay({
                score: Math.floor(Math.random() * 1000),
                games_played: Math.floor(Math.random() * 50),
                high_score: Math.floor(Math.random() * 100),
                duel_wins: Math.floor(Math.random() * 20)
            });
        }

        function updateUserDisplay(user) {
            document.getElementById('username').textContent = user.username || 'ç”¨æˆ·';
            document.getElementById('userEmail').textContent = user.email || '';
        }

        function updateStatsDisplay(stats) {
            document.getElementById('userScore').textContent = stats.score;
            document.getElementById('gamesPlayed').textContent = stats.games_played;
            document.getElementById('highScore').textContent = stats.high_score;
            document.getElementById('duelWins').textContent = stats.duel_wins;
        }

        function setupEventListeners() {
            // çŸ¥è¯†ç‚¹è¡¨å•æäº¤
            document.getElementById('knowledgeSubmissionForm').addEventListener('submit', submitKnowledge);
            
            // æ¸¸æˆè¡¨å•æäº¤
            document.getElementById('gameSubmissionForm').addEventListener('submit', submitGame);
            
            // çŸ¥è¯†ç‚¹æœç´¢
            document.getElementById('knowledgeSearch').addEventListener('input', searchKnowledge);
            
            // å¯¹é”™åˆ¤æ–­ç­”æ¡ˆé€‰æ‹©
            document.querySelectorAll('.tf-answer').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tf-answer').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('tfAnswer').value = this.dataset.value;
                });
            });
            
            // éš¾åº¦é€‰æ‹©
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('gameDifficulty').value = this.dataset.value;
                });
            });
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­çŸ¥è¯†ç‚¹åˆ—è¡¨
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.knowledge-selector')) {
                    document.getElementById('knowledgeList').classList.remove('active');
                }
            });
        }

        function switchType(type) {
            const knowledgeBtn = document.querySelector('.type-btn:nth-child(1)');
            const gameBtn = document.querySelector('.type-btn:nth-child(2)');
            const knowledgeForm = document.getElementById('knowledgeForm');
            const gameForm = document.getElementById('gameForm');
            
            if (type === 'knowledge') {
                knowledgeBtn.classList.add('active');
                gameBtn.classList.remove('active');
                knowledgeForm.style.display = 'block';
                gameForm.style.display = 'none';
            } else {
                gameBtn.classList.add('active');
                knowledgeBtn.classList.remove('active');
                knowledgeForm.style.display = 'none';
                gameForm.style.display = 'block';
            }
        }

        function toggleSelection(element) {
            element.classList.toggle('selected');
        }

        function selectGameType(element) {
            document.querySelectorAll('.game-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            const gameType = element.dataset.type;
            showGameTypeContent(gameType);
        }

        function showGameTypeContent(type) {
            // éšè—æ‰€æœ‰æ¸¸æˆå†…å®¹åŒºåŸŸ
            document.getElementById('matchGameContent').style.display = 'none';
            document.getElementById('trueFalseContent').style.display = 'none';
            document.getElementById('guessContent').style.display = 'none';
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ¸¸æˆç±»å‹å†…å®¹
            switch(type) {
                case 'matching':
                    document.getElementById('matchGameContent').style.display = 'block';
                    break;
                case 'true_false':
                    document.getElementById('trueFalseContent').style.display = 'block';
                    break;
                case 'guess':
                    document.getElementById('guessContent').style.display = 'block';
                    break;
            }
        }

        function searchKnowledge() {
            const searchTerm = document.getElementById('knowledgeSearch').value.toLowerCase();
            const knowledgeList = document.getElementById('knowledgeList');
            
            if (searchTerm.length > 0) {
                // ä»å¯ç”¨çŸ¥è¯†ç‚¹ä¸­æœç´¢
                const results = availableKnowledge.filter(item => 
                    item.title && item.title.toLowerCase().includes(searchTerm)
                ).slice(0, 10); // é™åˆ¶æ˜¾ç¤º10ä¸ªç»“æœ
                
                knowledgeList.innerHTML = '';
                results.forEach(result => {
                    const item = document.createElement('div');
                    item.className = 'knowledge-item';
                    item.innerHTML = `
                        <div><strong>${result.title}</strong></div>
                        <small style="color: var(--text-secondary);">${result.subject || 'æœªåˆ†ç±»'}</small>
                    `;
                    item.onclick = () => {
                        document.getElementById('knowledgeSearch').value = result.title;
                        knowledgeList.classList.remove('active');
                    };
                    knowledgeList.appendChild(item);
                });
                
                if (results.length > 0) {
                    knowledgeList.classList.add('active');
                } else {
                    knowledgeList.classList.remove('active');
                }
            } else {
                knowledgeList.classList.remove('active');
            }
        }

        function showMessage(type, message, formId) {
            const messageDiv = document.getElementById(formId + 'Message');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'exclamation-triangle'}"></i>
                <div>${message}</div>
            `;
            messageDiv.classList.remove('hidden');
            
            // 5ç§’åéšè—æ¶ˆæ¯
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }

        async function submitKnowledge(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showMessage('error', 'è¯·å…ˆç™»å½•', 'knowledge');
                return;
            }
            
            // æ”¶é›†è¡¨å•æ•°æ®
            const selectedSubjects = Array.from(document.querySelectorAll('#subjectSelection .subject-option.selected'))
                .map(el => el.dataset.id).join(',');
            
            const selectedTags = Array.from(document.querySelectorAll('#categoryTags .tag-btn.selected'))
                .map(btn => btn.dataset.id).join(',');
            
            const selectedDifficulty = document.querySelector('#difficultyTags .tag-btn.selected')?.textContent || '';
            
            if (!selectedSubjects) {
                showMessage('error', 'è¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªç§‘ç›®', 'knowledge');
                return;
            }
            
            if (!selectedDifficulty) {
                showMessage('error', 'è¯·é€‰æ‹©éš¾åº¦çº§åˆ«', 'knowledge');
                return;
            }
            
            const formData = {
                title: document.getElementById('knowledgeTitle').value.trim(),
                content: document.getElementById('knowledgeContent').value.trim(),
                example: document.getElementById('knowledgeExample').value.trim(),
                user_id: currentUser.id,
                author_name: currentUser.username,
                status: 'pending',
                category: 'knowledge',
                difficulty: selectedDifficulty,
                tags: selectedTags,
                subject: selectedSubjects,
                created_at: new Date().toISOString()
            };
            
            // éªŒè¯å¿…å¡«é¡¹
            if (!formData.title || !formData.content) {
                showMessage('error', 'è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹', 'knowledge');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const submitBtn = e.target.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> æäº¤ä¸­...';
            submitBtn.disabled = true;
            
            try {
                // å°è¯•æäº¤åˆ°Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/submissions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('æŠ•ç¨¿æˆåŠŸ:', result);
                    
                    showMessage('success', 'çŸ¥è¯†ç‚¹æŠ•ç¨¿æäº¤æˆåŠŸï¼ç­‰å¾…å®¡æ ¸ä¸­...', 'knowledge');
                    
                    // é‡ç½®è¡¨å•
                    e.target.reset();
                    document.querySelectorAll('#subjectSelection .subject-option.selected, #categoryTags .tag-btn.selected, #difficultyTags .tag-btn.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // åŒæ—¶å°†çŸ¥è¯†ç‚¹ä¿å­˜åˆ°knowledge_pointsè¡¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
                    const knowledgeData = {
                        subject: formData.subject.split(',')[0], // å–ç¬¬ä¸€ä¸ªç§‘ç›®
                        category_group: formData.tags || '',
                        title: formData.title,
                        content: formData.content,
                        difficulty: formData.difficulty,
                        created_at: formData.created_at
                    };
                    
                    try {
                        await fetch(`${SUPABASE_URL}/rest/v1/knowledge_points`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(knowledgeData)
                        });
                    } catch (knowledgeError) {
                        console.warn('æ— æ³•ä¿å­˜åˆ°knowledge_pointsè¡¨:', knowledgeError);
                    }
                    
                } else {
                    throw new Error(`æŠ•ç¨¿å¤±è´¥: ${response.status}`);
                }
                
            } catch (error) {
                console.error('æäº¤å¤±è´¥:', error);
                
                // å¦‚æœSupabaseæäº¤å¤±è´¥ï¼Œå°è¯•ä¿å­˜åˆ°localStorageä½œä¸ºå¤‡ä»½
                try {
                    const submissions = JSON.parse(localStorage.getItem('pending_submissions') || '[]');
                    submissions.push({
                        ...formData,
                        local_id: Date.now(),
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('pending_submissions', JSON.stringify(submissions));
                    
                    showMessage('warning', 'æŠ•ç¨¿å·²æœ¬åœ°ä¿å­˜ï¼Œç½‘ç»œæ¢å¤åå°†è‡ªåŠ¨åŒæ­¥', 'knowledge');
                } catch (localError) {
                    showMessage('error', 'æŠ•ç¨¿æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'knowledge');
                }
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function submitGame(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showMessage('error', 'è¯·å…ˆç™»å½•', 'game');
                return;
            }
            
            const selectedGameType = document.querySelector('.game-type-card.selected');
            if (!selectedGameType) {
                showMessage('error', 'è¯·é€‰æ‹©æ¸¸æˆç±»å‹', 'game');
                return;
            }
            
            const gameType = selectedGameType.dataset.type;
            let gameData = {};
            let isValid = true;
            
            // æ ¹æ®æ¸¸æˆç±»å‹æ”¶é›†æ•°æ®
            switch(gameType) {
                case 'matching':
                    const examples = document.getElementById('matchExamples').value.trim();
                    const topic = document.getElementById('matchTopic').value.trim();
                    if (!topic || !examples) {
                        showMessage('error', 'è¯·å¡«å†™ä¸»é¢˜å’Œé…å¯¹é¡¹ç›®', 'game');
                        isValid = false;
                    } else {
                        gameData = {
                            topic: topic,
                            examples: examples
                        };
                    }
                    break;
                    
                case 'true_false':
                    const question = document.getElementById('tfQuestion').value.trim();
                    const answer = document.getElementById('tfAnswer').value;
                    if (!question || !answer) {
                        showMessage('error', 'è¯·å¡«å†™é—®é¢˜å’Œé€‰æ‹©ç­”æ¡ˆ', 'game');
                        isValid = false;
                    } else {
                        gameData = {
                            question: question,
                            answer: answer,
                            explanation: document.getElementById('tfExplanation').value.trim()
                        };
                    }
                    break;
                    
                case 'guess':
                    const description = document.getElementById('guessDescription').value.trim();
                    const guessAnswer = document.getElementById('guessAnswer').value.trim();
                    if (!description || !guessAnswer) {
                        showMessage('error', 'è¯·å¡«å†™æè¿°å’Œæ­£ç¡®ç­”æ¡ˆ', 'game');
                        isValid = false;
                    } else {
                        gameData = {
                            description: description,
                            answer: guessAnswer,
                            hints: document.getElementById('guessHints').value.trim()
                        };
                    }
                    break;
            }
            
            if (!isValid) return;
            
            const difficulty = document.getElementById('gameDifficulty').value;
            const subject = document.getElementById('gameSubject').value;
            
            if (!difficulty) {
                showMessage('error', 'è¯·é€‰æ‹©éš¾åº¦çº§åˆ«', 'game');
                return;
            }
            
            const formData = {
                title: document.getElementById('gameTitle').value.trim(),
                knowledge_title: document.getElementById('knowledgeSearch').value.trim(),
                difficulty: difficulty,
                game_type: gameType,
                game_data: JSON.stringify(gameData),
                user_id: currentUser.id,
                author_name: currentUser.username,
                status: 'pending',
                category: 'game',
                subject: subject,
                created_at: new Date().toISOString()
            };
            
            // éªŒè¯å¿…å¡«é¡¹
            if (!formData.title) {
                showMessage('error', 'è¯·å¡«å†™æ¸¸æˆæ ‡é¢˜', 'game');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const submitBtn = e.target.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> æäº¤ä¸­...';
            submitBtn.disabled = true;
            
            try {
                // å°è¯•æäº¤åˆ°Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/submissions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('æ¸¸æˆæŠ•ç¨¿æˆåŠŸ:', result);
                    
                    showMessage('success', 'å°æ¸¸æˆæŠ•ç¨¿æäº¤æˆåŠŸï¼ç­‰å¾…å®¡æ ¸ä¸­...', 'game');
                    
                    // é‡ç½®è¡¨å•
                    e.target.reset();
                    document.querySelectorAll('.game-type-card.selected, .tf-answer.selected, .difficulty-btn.selected, #gameSubjectTags .tag-btn.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // æ¸…ç©ºéšè—å­—æ®µ
                    document.getElementById('gameDifficulty').value = '';
                    document.getElementById('gameSubject').value = '';
                    document.getElementById('tfAnswer').value = '';
                    
                    // éšè—æ¸¸æˆå†…å®¹åŒºåŸŸ
                    document.querySelectorAll('[id$="Content"]').forEach(el => {
                        el.style.display = 'none';
                    });
                    
                } else {
                    throw new Error(`æŠ•ç¨¿å¤±è´¥: ${response.status}`);
                }
                
            } catch (error) {
                console.error('æäº¤å¤±è´¥:', error);
                
                // å¦‚æœSupabaseæäº¤å¤±è´¥ï¼Œå°è¯•ä¿å­˜åˆ°localStorageä½œä¸ºå¤‡ä»½
                try {
                    const submissions = JSON.parse(localStorage.getItem('pending_submissions') || '[]');
                    submissions.push({
                        ...formData,
                        local_id: Date.now(),
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('pending_submissions', JSON.stringify(submissions));
                    
                    showMessage('warning', 'æŠ•ç¨¿å·²æœ¬åœ°ä¿å­˜ï¼Œç½‘ç»œæ¢å¤åå°†è‡ªåŠ¨åŒæ­¥', 'game');
                } catch (localError) {
                    showMessage('error', 'æŠ•ç¨¿æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'game');
                }
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        function openGames() {
            // è¿™é‡Œå¯ä»¥é“¾æ¥åˆ°æ‚¨çš„å°æ¸¸æˆç½‘ç«™
            window.open('https://3e4e592l5353-bot.github.io/DSEHub/games', '_blank');
        }

        function openNotes() {
            // è¿™é‡Œå¯ä»¥é“¾æ¥åˆ°æ‚¨çš„ç¬”è®°ä¸“åŒº
            window.open('https://3e4e592l5353-bot.github.io/DSEHub/notes', '_blank');
        }

        // è‡ªåŠ¨åŒæ­¥æœ¬åœ°ä¿å­˜çš„æŠ•ç¨¿
        async function syncPendingSubmissions() {
            try {
                const pendingSubmissions = JSON.parse(localStorage.getItem('pending_submissions') || '[]');
                if (pendingSubmissions.length === 0) return;
                
                console.log(`å‘ç° ${pendingSubmissions.length} ä¸ªå¾…åŒæ­¥æŠ•ç¨¿`);
                
                const successfulSyncs = [];
                
                for (const submission of pendingSubmissions) {
                    try {
                        const response = await fetch(`${SUPABASE_URL}/rest/v1/submissions`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': SUPABASE_KEY,
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Prefer': 'return=representation'
                            },
                            body: JSON.stringify(submission)
                        });
                        
                        if (response.ok) {
                            successfulSyncs.push(submission.local_id);
                            console.log(`å·²åŒæ­¥æŠ•ç¨¿: ${submission.title}`);
                        }
                    } catch (error) {
                        console.warn(`åŒæ­¥æŠ•ç¨¿å¤±è´¥: ${submission.title}`, error);
                    }
                }
                
                // ç§»é™¤å·²æˆåŠŸåŒæ­¥çš„æŠ•ç¨¿
                if (successfulSyncs.length > 0) {
                    const remainingSubmissions = pendingSubmissions.filter(
                        sub => !successfulSyncs.includes(sub.local_id)
                    );
                    localStorage.setItem('pending_submissions', JSON.stringify(remainingSubmissions));
                    
                    if (remainingSubmissions.length === 0) {
                        console.log('æ‰€æœ‰å¾…åŒæ­¥æŠ•ç¨¿å·²æˆåŠŸä¸Šä¼ ');
                    }
                }
            } catch (error) {
                console.error('åŒæ­¥æŠ•ç¨¿æ—¶å‡ºé”™:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶å°è¯•åŒæ­¥
        window.addEventListener('load', syncPendingSubmissions);
        
        // å®šæœŸå°è¯•åŒæ­¥ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        setInterval(syncPendingSubmissions, 5 * 60 * 1000);
    </script>
</body>
</html>

